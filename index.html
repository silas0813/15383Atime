<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>15383A時間記錄打卡系統</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="manifest" herf="manifest.json">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
	<link rel="icon" type="image/x-icon" href="img/icon8.png">
	<link rel="manifest" href="manifest.json">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <style>
        :root {
            --primary-color: #5D5CDE;
            --active-color: #ff4d4d;
        }

        .light-theme {
            --bg-color: #f5f5f7;
            --card-bg: #ffffff;
            --text-color: #333333;
            --secondary-text: #666666;
            --border-color: #e2e2e2;
            --button-bg: #ffffff;
            --button-border: #e2e2e2;
            --time-display-bg: #f5f5f7;
            --record-bg: #ffffff;
            --tab-active-bg: #ffffff;
            --tab-inactive-bg: #e2e2e2;
            --input-bg: #ffffff;
        }

        .dark-theme {
            --bg-color: #121212;
            --card-bg: #1E1E1E;
            --text-color: #E0E0E0;
            --secondary-text: #AAAAAA;
            --border-color: #444444;
            --button-bg: #333333;
            --button-border: #444444;
            --time-display-bg: #2A2A2A;
            --record-bg: #2A2A2A;
            --tab-active-bg: #2A2A2A;
            --tab-inactive-bg: #444444;
            --input-bg: #333333;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            touch-action: manipulation;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .card {
            background-color: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s ease;
        }

        .activity-btn {
            transition: all 0.2s ease;
            border: 2px solid var(--button-border);
            background-color: var(--button-bg);
            color: var(--text-color);
            font-weight: bold;
            border-radius: 10px;
            font-size: 16px;
        }

        .activity-btn:active {
            transform: scale(0.97);
        }

        .activity-btn.active {
            background-color: var(--active-color);
            color: white;
            border-color: var(--active-color);
        }

        .time-display {
            background-color: var(--time-display-bg);
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            font-weight: bold;
            font-family: monospace;
            font-size: 18px;
            color: var(--primary-color);
            transition: background-color 0.3s ease;
        }

        .dark-theme .time-display {
            color: #00E676;
        }

        .record-item {
            background-color: var(--record-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            transition: background-color 0.3s ease;
        }

        .theme-toggle {
            position: fixed;
            top: 10px;
            right: 10px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            z-index: 10;
            transition: transform 0.3s ease;
        }

        .theme-toggle:active {
            transform: scale(0.95);
        }

        .export-modal {
            background-color: var(--card-bg);
            color: var(--text-color);
            transition: background-color 0.3s ease;
        }

        .export-header {
            background-color: var(--primary-color);
            color: white;
        }

        .preview-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 16px;
            font-size: 14px;
        }

        .preview-table th {
            background-color: var(--primary-color);
            color: white;
            padding: 8px;
            text-align: left;
        }

        .preview-table td {
            padding: 8px;
            border-bottom: 1px solid var(--border-color);
        }

        .dark-theme .preview-table th {
            background-color: #444;
        }

        .preview-container {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            margin-bottom: 16px;
        }

        /* 選項卡樣式 */
        .tab {
            padding: 10px 16px;
            border-radius: 8px 8px 0 0;
            background-color: var(--tab-inactive-bg);
            color: var(--text-color);
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .tab.active {
            background-color: var(--tab-active-bg);
            border-bottom: 3px solid var(--primary-color);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* 表單輸入樣式 */
        .form-input {
            width: 100%;
            padding: 10px 12px;
            background-color: var(--input-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-color);
            font-size: 16px;
            transition: border-color 0.2s ease;
        }

        .form-input:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-color);
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-divider {
            height: 1px;
            background-color: var(--border-color);
            margin: 20px 0;
        }

        .form-section-title {
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--primary-color);
        }

        /* 開關樣式 */
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
            margin-left: 8px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary-color);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        /* 自定義單選按鈕 */
        .radio-container {
            display: flex;
            gap: 10px;
            margin-bottom: 16px;
        }
        
        .radio-btn {
            background-color: var(--button-bg);
            border: 2px solid var(--button-border);
            color: var(--text-color);
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 600;
            text-align: center;
            cursor: pointer;
            flex: 1;
            transition: all 0.2s ease;
        }
        
        .radio-btn.active {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }
    </style>
</head>
<body class="light-theme">
    <button id="themeToggle" class="theme-toggle" aria-label="切換主題">
        <i class="fas fa-moon"></i>
    </button>
    
    <div class="container mx-auto max-w-md p-4 pt-12">
        <h1 class="text-xl font-bold text-center mb-3">15383A時間記錄系統</h1>
        
        <!-- 選項卡導航 -->
        <div class="flex mb-4">
            <div class="tab active" data-tab="timeTracking">時間記錄</div>
            <div class="tab" data-tab="matchRecords">比賽記錄</div>
            <div class="tab" data-tab="skillRecords">技能賽記錄</div>
        </div>
        
        <!-- 時間記錄選項卡 -->
        <div id="timeTracking" class="tab-content active">
            <div class="card p-5 mb-4">
                <div class="time-display mb-4" id="currentTimeDisplay">
                    00:00:00
                </div>
                
                <div class="grid grid-cols-2 gap-3 mb-4" id="activityButtonsContainer">
                    <!-- 按鈕將通過JavaScript動態生成 -->
                </div>
                
                <div class="flex space-x-3">
                    <button id="clearBtn" class="flex-1 bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-4 rounded-lg">
                        清除記錄
                    </button>
                    <button id="exportBtn" class="flex-1 bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg">
                        <i class="fas fa-file-excel mr-1"></i> 導出Excel
                    </button>
                </div>
            </div>
            
            <div class="card p-5">
                <h2 class="text-lg font-bold mb-3">活動記錄</h2>
                <div id="recordsList" class="max-h-96 overflow-y-auto">
                    <div class="text-center text-gray-500 py-4">尚無記錄</div>
                </div>
            </div>
        </div>
        
        <!-- 比賽記錄選項卡 -->
        <div id="matchRecords" class="tab-content">
            <div class="card p-5 mb-4">
                <h2 class="text-lg font-bold mb-3">添加比賽記錄</h2>
                
                <!-- 將日期和場數/回合放在同一行 -->
                <div class="grid grid-cols-2 gap-3">
                    <div class="form-group">
                        <label for="matchDate" class="form-label">比賽日期</label>
                        <input type="date" id="matchDate" class="form-input">
                    </div>
                    <div class="form-group">
                        <label for="matchCount" class="form-label">場數/回合</label>
                        <input type="text" id="matchCount" class="form-input" placeholder="如: 3, R1, A2">
                    </div>
                </div>
                
                <div class="form-divider"></div>
                
                <div class="form-section-title">己方信息</div>
                <div class="grid grid-cols-2 gap-3">
                    <div class="form-group">
                        <label for="myTeamNumber" class="form-label">己方隊伍編號/名稱</label>
                        <input type="text" id="myTeamNumber" class="form-input" placeholder="如: A1, Team3">
                    </div>
                    <div class="form-group">
                        <label for="teammateNumber" class="form-label">隊友編號/名稱</label>
                        <input type="text" id="teammateNumber" class="form-input" placeholder="如: B2, John">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="myTeamScore" class="form-label">己方分數</label>
                    <input type="number" id="myTeamScore" class="form-input" min="0" placeholder="輸入己方分數">
                </div>
                
                <div class="form-group">
                    <label class="form-label flex items-center justify-between">
                        己方自動模式獲勝
                        <label class="switch">
                            <input type="checkbox" id="myTeamAutoWin">
                            <span class="slider"></span>
                        </label>
                    </label>
                </div>
                
                <div class="form-divider"></div>
                
                <div class="form-section-title">對方信息</div>
                <div class="grid grid-cols-2 gap-3">
                    <div class="form-group">
                        <label for="opponentTeam1" class="form-label">對方隊伍1編號/名稱</label>
                        <input type="text" id="opponentTeam1" class="form-input" placeholder="如: C3, TeamX">
                    </div>
                    <div class="form-group">
                        <label for="opponentTeam2" class="form-label">對方隊伍2編號/名稱</label>
                        <input type="text" id="opponentTeam2" class="form-input" placeholder="如: D4, TeamY">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="opponentScore" class="form-label">對方分數</label>
                    <input type="number" id="opponentScore" class="form-input" min="0" placeholder="輸入對方分數">
                </div>
                
                <div class="form-group">
                    <label class="form-label flex items-center justify-between">
                        敵方自動模式獲勝
                        <label class="switch">
                            <input type="checkbox" id="opponentAutoWin">
                            <span class="slider"></span>
                        </label>
                    </label>
                </div>
                
                <button id="saveMatchBtn" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-lg">
                    保存比賽記錄
                </button>
            </div>
            
            <div class="flex space-x-3 mb-4">
                <button id="clearMatchBtn" class="flex-1 bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-4 rounded-lg">
                    清除記錄
                </button>
                <button id="exportMatchBtn" class="flex-1 bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg">
                    <i class="fas fa-file-excel mr-1"></i> 導出Excel
                </button>
            </div>
            
            <div class="card p-5">
                <h2 class="text-lg font-bold mb-3">比賽記錄列表</h2>
                <div id="matchRecordsList" class="max-h-96 overflow-y-auto">
                    <div class="text-center text-gray-500 py-4">尚無比賽記錄</div>
                </div>
            </div>
        </div>
        
        <!-- 技能賽記錄選項卡 -->
        <div id="skillRecords" class="tab-content">
            <div class="card p-5 mb-4">
                <h2 class="text-lg font-bold mb-3">添加技能賽記錄</h2>
                
                <!-- 將日期和練習開關放在同一行 -->
                <div class="form-group">
                    <div class="flex items-center justify-between">
                        <label for="skillDate" class="form-label">比賽日期</label>
                        <label class="flex items-center">
                            <span class="mr-2 text-sm font-medium">練習</span>
                            <label class="switch">
                                <input type="checkbox" id="isPractice">
                                <span class="slider"></span>
                            </label>
                        </label>
                    </div>
                    <input type="date" id="skillDate" class="form-input">
                </div>
                
                <div class="form-group">
                    <label class="form-label">模式選擇</label>
                    <div class="radio-container">
                        <div class="radio-btn active" data-mode="manual">手動模式</div>
                        <div class="radio-btn" data-mode="auto">自動模式</div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="skillScore" class="form-label">分數</label>
                    <input type="number" id="skillScore" class="form-input" min="0" placeholder="輸入技能賽分數">
                </div>
                
                <button id="saveSkillBtn" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-lg">
                    保存技能賽記錄
                </button>
            </div>
            
            <div class="flex space-x-3 mb-4">
                <button id="clearSkillBtn" class="flex-1 bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-4 rounded-lg">
                    清除記錄
                </button>
                <button id="exportSkillBtn" class="flex-1 bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg">
                    <i class="fas fa-file-excel mr-1"></i> 導出Excel
                </button>
            </div>
            
            <div class="card p-5">
                <h2 class="text-lg font-bold mb-3">技能賽記錄列表</h2>
                <div id="skillRecordsList" class="max-h-96 overflow-y-auto">
                    <div class="text-center text-gray-500 py-4">尚無技能賽記錄</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 確保DOM完全加載後再執行腳本
        document.addEventListener('DOMContentLoaded', function() {
            // 系統配置
            const activities = [
                '編程', '建造', '練習', 'AWP', 'notebook',
                // 擴展點：在此添加新活動類型
            ];

            // 全局變量
            let records = [];
            let matchRecords = [];
            let skillRecords = [];
            let activeButton = null;
            let startTime = null;
            let currentTheme = 'light';
            let currentTab = 'timeTracking';
            let selectedMode = 'manual';
            
            // 保存用戶偏好設置
            let userPreferences = {
                isPractice: false
            };

            // DOM元素 - 時間記錄相關
            const timeDisplay = document.getElementById('currentTimeDisplay');
            const clearBtn = document.getElementById('clearBtn');
            const exportBtn = document.getElementById('exportBtn');
            const recordsList = document.getElementById('recordsList');
            const themeToggle = document.getElementById('themeToggle');
            const body = document.body;
            const activityButtonsContainer = document.getElementById('activityButtonsContainer');
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');
            
            // DOM元素 - 比賽記錄相關
            const matchDate = document.getElementById('matchDate');
            const myTeamNumber = document.getElementById('myTeamNumber');
            const teammateNumber = document.getElementById('teammateNumber');
            const myTeamScore = document.getElementById('myTeamScore');
            const opponentTeam1 = document.getElementById('opponentTeam1');
            const opponentTeam2 = document.getElementById('opponentTeam2');
            const opponentScore = document.getElementById('opponentScore');
            const matchCount = document.getElementById('matchCount');
            const myTeamAutoWin = document.getElementById('myTeamAutoWin');
            const opponentAutoWin = document.getElementById('opponentAutoWin');
            const saveMatchBtn = document.getElementById('saveMatchBtn');
            const clearMatchBtn = document.getElementById('clearMatchBtn');
            const exportMatchBtn = document.getElementById('exportMatchBtn');
            const matchRecordsList = document.getElementById('matchRecordsList');
            
            // DOM元素 - 技能賽相關
            const skillDate = document.getElementById('skillDate');
            const radioButtons = document.querySelectorAll('.radio-btn');
            const skillScore = document.getElementById('skillScore');
            const isPractice = document.getElementById('isPractice');  // 練習開關
            const saveSkillBtn = document.getElementById('saveSkillBtn');
            const clearSkillBtn = document.getElementById('clearSkillBtn');
            const exportSkillBtn = document.getElementById('exportSkillBtn');
            const skillRecordsList = document.getElementById('skillRecordsList');

            // 初始化
            function init() {
                console.log("初始化應用...");
                
                // 渲染活動按鈕
                renderActivityButtons();
                
                // 加載存儲的記錄
                loadRecords();
                loadMatchRecords();
                loadSkillRecords();
                
                // 加載主題偏好
                loadThemePreference();
                
                // 加載用戶偏好設置
                loadUserPreferences();
                
                // 設置今天日期
                const today = new Date().toISOString().split('T')[0];
                if(matchDate) matchDate.value = today;
                if(skillDate) skillDate.value = today;
                
                // 更新時間顯示
                updateTimeDisplay();
                setInterval(updateTimeDisplay, 1000);

                // 綁定事件監聽器 - 通用
                if(themeToggle) themeToggle.addEventListener('click', toggleTheme);
                
                // 選項卡切換事件
                tabs.forEach(tab => {
                    tab.addEventListener('click', function() {
                        const tabId = this.getAttribute('data-tab');
                        switchTab(tabId);
                    });
                });
                
                // 綁定事件監聽器 - 時間記錄
                if(activityButtonsContainer) activityButtonsContainer.addEventListener('click', handleActivityButtonClick);
                if(clearBtn) clearBtn.addEventListener('click', clearRecords);
                if(exportBtn) exportBtn.addEventListener('click', exportToExcel);
                
                // 綁定事件監聽器 - 比賽記錄
                if(saveMatchBtn) saveMatchBtn.addEventListener('click', saveMatchRecord);
                if(clearMatchBtn) clearMatchBtn.addEventListener('click', clearMatchRecords);
                if(exportMatchBtn) exportMatchBtn.addEventListener('click', exportMatchRecords);
                
                // 綁定事件監聽器 - 技能賽記錄
                // 模式選擇按鈕
                radioButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        radioButtons.forEach(btn => btn.classList.remove('active'));
                        this.classList.add('active');
                        selectedMode = this.getAttribute('data-mode');
                    });
                });
                
                // 練習模式偏好保存
                if(isPractice) {
                    isPractice.addEventListener('change', function() {
                        userPreferences.isPractice = this.checked;
                        saveUserPreferences();
                    });
                }
                
                if(saveSkillBtn) saveSkillBtn.addEventListener('click', saveSkillRecord);
                if(clearSkillBtn) clearSkillBtn.addEventListener('click', clearSkillRecords);
                if(exportSkillBtn) exportSkillBtn.addEventListener('click', exportSkillRecords);
                
                console.log("初始化完成！");
            }
            
            // 加載用戶偏好設置
            function loadUserPreferences() {
                const saved = localStorage.getItem('userPreferences');
                if (saved) {
                    try {
                        const prefs = JSON.parse(saved);
                        userPreferences = {...userPreferences, ...prefs};
                        
                        // 應用保存的練習模式設置
                        if(isPractice && userPreferences.isPractice !== undefined) {
                            isPractice.checked = userPreferences.isPractice;
                        }
                    } catch (e) {
                        console.error("加載用戶偏好設置出錯:", e);
                    }
                }
            }
            
            // 保存用戶偏好設置
            function saveUserPreferences() {
                localStorage.setItem('userPreferences', JSON.stringify(userPreferences));
            }

            function renderActivityButtons() {
                if(!activityButtonsContainer) return;
                
                activityButtonsContainer.innerHTML = '';
                activities.forEach(activity => {
                    const button = document.createElement('button');
                    button.className = 'activity-btn p-4';
                    button.dataset.type = activity;
                    button.textContent = activity;
                    activityButtonsContainer.appendChild(button);
                });
            }
            
            // 選項卡切換
            function switchTab(tabId) {
                tabs.forEach(tab => {
                    tab.classList.toggle('active', tab.getAttribute('data-tab') === tabId);
                });
                
                tabContents.forEach(content => {
                    content.classList.toggle('active', content.id === tabId);
                });
                
                currentTab = tabId;
            }

            // 主題功能
            function loadThemePreference() {
                const savedTheme = localStorage.getItem('timeTrackerTheme');
                if (savedTheme) {
                    currentTheme = savedTheme;
                    updateTheme();
                }
            }

            function toggleTheme() {
                currentTheme = currentTheme === 'light' ? 'dark' : 'light';
                updateTheme();
                localStorage.setItem('timeTrackerTheme', currentTheme);
            }

            function updateTheme() {
                body.classList.toggle('dark-theme', currentTheme === 'dark');
                body.classList.toggle('light-theme', currentTheme === 'light');
                if(themeToggle) {
                    themeToggle.innerHTML = currentTheme === 'dark' 
                        ? '<i class="fas fa-sun"></i>' 
                        : '<i class="fas fa-moon"></i>';
                }
            }

            // 時間顯示
            function updateTimeDisplay() {
                if(!timeDisplay) return;
                
                const now = new Date();
                timeDisplay.textContent = now.toLocaleString('zh-Hant', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit',
                    hour12: false
                }).replace(/\//g, '-');
            }

            // 時間記錄處理
            function handleActivityButtonClick(event) {
                const button = event.target.closest('.activity-btn');
                if (!button) return;

                const now = new Date();

                if (activeButton === button) {
                    endActivity(button.dataset.type, now);
                    button.classList.remove('active');
                    activeButton = null;
                    startTime = null;
                } else if (activeButton) {
                    endActivity(activeButton.dataset.type, now);
                    activeButton.classList.remove('active');
                    button.classList.add('active');
                    activeButton = button;
                    startTime = now;
                } else {
                    button.classList.add('active');
                    activeButton = button;
                    startTime = now;
                }
            }

            function endActivity(activityType, endTime) {
                const durationMs = endTime - startTime;
                const duration = new Date(durationMs).toISOString().substr(11, 5);
                const record = {
                    type: activityType,
                    startTime: startTime.getTime(),
                    endTime: endTime.getTime(),
                    startFormatted: formatDateTime(startTime),
                    endFormatted: formatDateTime(endTime),
                    duration: duration
                };

                records.unshift(record);
                saveRecords();
                renderRecords();
            }

            function formatDateTime(date) {
                return date.toLocaleString('zh-Hant', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: false
                }).replace(/\//g, '-');
            }

            function renderRecords() {
                if(!recordsList) return;
                
                recordsList.innerHTML = records.length ? '' : '<div class="text-center text-gray-500 py-4">尚無記錄</div>';
                
                records.forEach((record, index) => {
                    const [startDate, startTime] = record.startFormatted.split(' ');
                    const [endDate, endTime] = record.endFormatted.split(' ');

                    const recordItem = document.createElement('div');
                    recordItem.className = 'record-item';
                    recordItem.innerHTML = `
                        <div class="flex justify-between items-center">
                            <div>
                                <div class="font-bold text-lg">${record.type}</div>
                                <div class="text-sm text-opacity-80" style="color: var(--secondary-text)">
                                    ${startDate} ${startTime} - ${endTime}
                                </div>
                                <div class="text-sm mt-1 text-opacity-80" style="color: var(--secondary-text)">
                                    持續: ${record.duration}
                                </div>
                            </div>
                            <button class="delete-btn" data-index="${index}">
                                <svg class="h-5 w-5 text-red-500 hover:text-red-600" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"/>
                                </svg>
                            </button>
                        </div>
                    `;
                    
                    recordItem.querySelector('.delete-btn').addEventListener('click', () => deleteRecord(index));
                    recordsList.appendChild(recordItem);
                });
            }

            function deleteRecord(index) {
                records.splice(index, 1);
                saveRecords();
                renderRecords();
            }

            function clearRecords() {
                if (confirm('確定要清除所有時間記錄嗎？此操作無法撤銷。')) {
                    records = [];
                    saveRecords();
                    renderRecords();
                }
            }

            function saveRecords() {
                localStorage.setItem('timeRecords', JSON.stringify(records));
            }

            function loadRecords() {
                const saved = localStorage.getItem('timeRecords');
                if (saved) {
                    records = JSON.parse(saved);
                    renderRecords();
                }
            }

            // 比賽記錄功能
            function saveMatchRecord() {
                console.log("嘗試保存比賽記錄...");
                
                const date = matchDate.value;
                const teamNumber = myTeamNumber.value.trim();
                const teammate = teammateNumber.value.trim();
                const myScore = myTeamScore.value;
                const opponent1 = opponentTeam1.value.trim();
                const opponent2 = opponentTeam2.value.trim();
                const oppScore = opponentScore.value;
                const count = matchCount.value.trim();
                const myTeamWin = myTeamAutoWin.checked;
                const oppTeamWin = opponentAutoWin.checked;
                
                if (!date || !teamNumber || !myScore || !opponent1 || !oppScore || !count) {
                    alert('請填寫必要的比賽信息（日期、己方隊伍、己方分數、對方隊伍1、對方分數、場數/回合）');
                    return;
                }
                
                const matchRecord = {
                    id: Date.now(),
                    date: date,
                    myTeam: teamNumber,
                    teammate: teammate || "未指定",
                    myScore: parseInt(myScore),
                    opponent1: opponent1,
                    opponent2: opponent2 || "未指定",
                    opponentScore: parseInt(oppScore),
                    count: count,
                    myTeamAutoWin: myTeamWin,
                    opponentAutoWin: oppTeamWin,
                    timestamp: new Date().toISOString()
                };
                
                console.log("新比賽記錄:", matchRecord);
                
                matchRecords.unshift(matchRecord);
                saveMatchRecords();
                renderMatchRecords();
                
                // 重置部分表單字段
                myTeamScore.value = '';
                opponentScore.value = '';
                matchCount.value = '';
                myTeamAutoWin.checked = false;
                opponentAutoWin.checked = false;
                
                alert('比賽記錄已保存！');
            }
            
            function renderMatchRecords() {
                if(!matchRecordsList) return;
                
                matchRecordsList.innerHTML = matchRecords.length ? '' : '<div class="text-center text-gray-500 py-4">尚無比賽記錄</div>';
                
                matchRecords.forEach((record, index) => {
                    // 處理向後兼容：檢查新舊格式的自動模式字段
                    const myAutoWinText = record.myTeamAutoWin ? '己方自動獲勝' : '';
                    const oppAutoWinText = record.opponentAutoWin ? '敵方自動獲勝' : '';
                    
                    // 舊記錄格式的處理
                    let autoWinText = '';
                    if (record.autoWin !== undefined) {
                        autoWinText = record.autoWin ? '自動模式獲勝' : '';
                    }
                    
                    // 組合自動模式狀態文本
                    let autoModeInfo = '';
                    if (myAutoWinText && oppAutoWinText) {
                        autoModeInfo = `${myAutoWinText}, ${oppAutoWinText}`;
                    } else if (myAutoWinText) {
                        autoModeInfo = myAutoWinText;
                    } else if (oppAutoWinText) {
                        autoModeInfo = oppAutoWinText;
                    } else if (autoWinText) {
                        autoModeInfo = autoWinText;
                    }
                    
                    const recordItem = document.createElement('div');
                    recordItem.className = 'record-item';
                    recordItem.innerHTML = `
                        <div class="flex justify-between items-center">
                            <div>
                                <div class="font-bold text-lg">${record.date} - 場數/回合: ${record.count}</div>
                                <div class="text-sm text-opacity-80" style="color: var(--secondary-text)">
                                    己方：${record.myTeam} | 對方：${record.opponent1}${record.opponent2 !== "未指定" ? '、' + record.opponent2 : ''}
                                </div>
                                <div class="text-sm text-opacity-80" style="color: var(--secondary-text)">
                                    比分: ${record.myScore} : ${record.opponentScore}
                                </div>
                                <div class="text-sm mt-1 text-opacity-80" style="color: var(--secondary-text)">
                                    隊友: ${record.teammate}${autoModeInfo ? ' | ' + autoModeInfo : ''}
                                </div>
                            </div>
                            <button class="delete-match-btn" data-index="${index}">
                                <svg class="h-5 w-5 text-red-500 hover:text-red-600" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"/>
                                </svg>
                            </button>
                        </div>
                    `;
                    
                    recordItem.querySelector('.delete-match-btn').addEventListener('click', () => deleteMatchRecord(index));
                    matchRecordsList.appendChild(recordItem);
                });
            }
            
            function deleteMatchRecord(index) {
                matchRecords.splice(index, 1);
                saveMatchRecords();
                renderMatchRecords();
            }
            
            function clearMatchRecords() {
                if (confirm('確定要清除所有比賽記錄嗎？此操作無法撤銷。')) {
                    matchRecords = [];
                    saveMatchRecords();
                    renderMatchRecords();
                }
            }
            
            function saveMatchRecords() {
                localStorage.setItem('matchRecords', JSON.stringify(matchRecords));
            }
            
            function loadMatchRecords() {
                const saved = localStorage.getItem('matchRecords');
                if (saved) {
                    matchRecords = JSON.parse(saved);
                    
                    // 處理舊版本的數據 - 將autoWin轉換為新格式
                    matchRecords.forEach(record => {
                        if (record.myTeamAutoWin === undefined && record.opponentAutoWin === undefined && record.autoWin !== undefined) {
                            record.myTeamAutoWin = record.autoWin;
                            record.opponentAutoWin = false;
                        }
                    });
                    
                    renderMatchRecords();
                }
            }
            
            function exportMatchRecords() {
                if (!matchRecords.length) {
                    alert('沒有比賽記錄可導出');
                    return;
                }
                
                const data = prepareMatchExcelData();
                showMatchExportModal(data);
            }
            
            function prepareMatchExcelData() {
                return matchRecords.map(record => {
                    // 處理向後兼容
                    const myTeamAuto = record.myTeamAutoWin !== undefined ? record.myTeamAutoWin : (record.autoWin || false);
                    const oppTeamAuto = record.opponentAutoWin !== undefined ? record.opponentAutoWin : false;
                    
                    return {
                        日期: record.date,
                        場數回合: record.count,
                        己方隊伍: record.myTeam,
                        隊友: record.teammate,
                        己方分數: record.myScore,
                        對方隊伍1: record.opponent1,
                        對方隊伍2: record.opponent2,
                        對方分數: record.opponentScore,
                        己方自動模式獲勝: myTeamAuto ? '是' : '否',
                        敵方自動模式獲勝: oppTeamAuto ? '是' : '否'
                    };
                });
            }
            
            function showMatchExportModal(data) {
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50';

                const modalContent = document.createElement('div');
                modalContent.className = 'export-modal rounded-lg w-full max-w-lg bg-white dark:bg-gray-800';
                
                modalContent.innerHTML = `
                    <div class="export-header px-4 py-3 flex justify-between items-center rounded-t-lg">
                        <h3 class="font-bold text-white">導出比賽記錄Excel</h3>
                        <button class="text-white hover:text-gray-200 close-btn">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
                            </svg>
                        </button>
                    </div>
                    <div class="p-4">
                        <div class="preview-container mb-4">
                            <table class="preview-table">
                                <thead>
                                    <tr>${Object.keys(data[0]).map(k => `<th>${k}</th>`).join('')}</tr>
                                </thead>
                                <tbody>
                                    ${data.slice(0, 5).map(row => `
                                        <tr>${Object.values(row).map(v => `<td>${v}</td>`).join('')}</tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                        <div class="flex justify-end space-x-3">
                            <button class="cancel-btn px-4 py-2 rounded bg-gray-200 hover:bg-gray-300">取消</button>
                            <button class="export-confirm-btn px-4 py-2 rounded bg-blue-500 text-white hover:bg-blue-600">
                                <i class="fas fa-download mr-2"></i>導出Excel
                            </button>
                        </div>
                    </div>
                `;

                modalContent.querySelector('.close-btn').onclick = 
                modalContent.querySelector('.cancel-btn').onclick = () => modal.remove();

                modalContent.querySelector('.export-confirm-btn').onclick = () => {
                    try {
                        const ws = XLSX.utils.json_to_sheet(data);
                        const wb = XLSX.utils.book_new();
                        XLSX.utils.book_append_sheet(wb, ws, "比賽記錄");
                        XLSX.writeFile(wb, `比賽記錄_${new Date().toISOString().slice(0,10)}.xlsx`);
                        modal.remove();
                    } catch (error) {
                        alert('導出失敗: ' + error.message);
                    }
                };

                modal.appendChild(modalContent);
                document.body.appendChild(modal);
            }
            
            // 技能賽記錄功能
            function saveSkillRecord() {
                console.log("嘗試保存技能賽記錄...");
                
                const date = skillDate.value;
                const score = skillScore.value;
                const practice = isPractice.checked;  // 獲取練習狀態
                
                if (!date || !score) {
                    alert('請填寫完整的技能賽信息（日期、分數）');
                    return;
                }
                
                const skillRecord = {
                    id: Date.now(),
                    date: date,
                    mode: selectedMode,
                    score: parseInt(score),
                    isPractice: practice,  // 保存練習狀態
                    timestamp: new Date().toISOString()
                };
                
                console.log("新技能賽記錄:", skillRecord);
                
                skillRecords.unshift(skillRecord);
                saveSkillRecords();
                renderSkillRecords();
                
                // 重置分數字段
                skillScore.value = '';
                // 練習狀態保持不變
                
                alert('技能賽記錄已保存！');
            }
            
            function renderSkillRecords() {
                if(!skillRecordsList) return;
                
                skillRecordsList.innerHTML = skillRecords.length ? '' : '<div class="text-center text-gray-500 py-4">尚無技能賽記錄</div>';
                
                skillRecords.forEach((record, index) => {
                    const recordItem = document.createElement('div');
                    recordItem.className = 'record-item';
                    recordItem.innerHTML = `
                        <div class="flex justify-between items-center">
                            <div>
                                <div class="font-bold text-lg">${record.date} ${record.isPractice ? '(練習)' : ''}</div>
                                <div class="text-sm text-opacity-80" style="color: var(--secondary-text)">
                                    模式: ${record.mode === 'manual' ? '手動' : '自動'} | 分數: ${record.score}
                                </div>
                                <div class="text-sm mt-1 text-opacity-80" style="color: var(--secondary-text)">
                                    記錄時間: ${new Date(record.timestamp).toLocaleTimeString('zh-Hant', {hour: '2-digit', minute: '2-digit', hour12: false})}
                                </div>
                            </div>
                            <button class="delete-skill-btn" data-index="${index}">
                                <svg class="h-5 w-5 text-red-500 hover:text-red-600" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"/>
                                </svg>
                            </button>
                        </div>
                    `;
                    
                    recordItem.querySelector('.delete-skill-btn').addEventListener('click', () => deleteSkillRecord(index));
                    skillRecordsList.appendChild(recordItem);
                });
            }
            
            function deleteSkillRecord(index) {
                skillRecords.splice(index, 1);
                saveSkillRecords();
                renderSkillRecords();
            }
            
            function clearSkillRecords() {
                if (confirm('確定要清除所有技能賽記錄嗎？此操作無法撤銷。')) {
                    skillRecords = [];
                    saveSkillRecords();
                    renderSkillRecords();
                }
            }
            
            function saveSkillRecords() {
                localStorage.setItem('skillRecords', JSON.stringify(skillRecords));
            }
            
            function loadSkillRecords() {
                const saved = localStorage.getItem('skillRecords');
                if (saved) {
                    skillRecords = JSON.parse(saved);
                    
                    // 兼容舊數據，如果沒有isPractice字段則添加
                    skillRecords.forEach(record => {
                        if (record.isPractice === undefined) {
                            record.isPractice = false;
                        }
                    });
                    
                    renderSkillRecords();
                }
            }
            
            function exportSkillRecords() {
                if (!skillRecords.length) {
                    alert('沒有技能賽記錄可導出');
                    return;
                }
                
                const data = prepareSkillExcelData();
                showSkillExportModal(data);
            }
            
            function prepareSkillExcelData() {
                return skillRecords.map(record => ({
                    日期: record.date,
                    模式: record.mode === 'manual' ? '手動' : '自動',
                    分數: record.score,
                    練習: record.isPractice ? '是' : '否'  // 添加練習欄位到Excel
                }));
            }
            
            function showSkillExportModal(data) {
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50';

                const modalContent = document.createElement('div');
                modalContent.className = 'export-modal rounded-lg w-full max-w-lg bg-white dark:bg-gray-800';
                
                modalContent.innerHTML = `
                    <div class="export-header px-4 py-3 flex justify-between items-center rounded-t-lg">
                        <h3 class="font-bold text-white">導出技能賽記錄Excel</h3>
                        <button class="text-white hover:text-gray-200 close-btn">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
                            </svg>
                        </button>
                    </div>
                    <div class="p-4">
                        <div class="preview-container mb-4">
                            <table class="preview-table">
                                <thead>
                                    <tr>${Object.keys(data[0]).map(k => `<th>${k}</th>`).join('')}</tr>
                                </thead>
                                <tbody>
                                    ${data.slice(0, 5).map(row => `
                                        <tr>${Object.values(row).map(v => `<td>${v}</td>`).join('')}</tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                        <div class="flex justify-end space-x-3">
                            <button class="cancel-btn px-4 py-2 rounded bg-gray-200 hover:bg-gray-300">取消</button>
                            <button class="export-confirm-btn px-4 py-2 rounded bg-blue-500 text-white hover:bg-blue-600">
                                <i class="fas fa-download mr-2"></i>導出Excel
                            </button>
                        </div>
                    </div>
                `;

                modalContent.querySelector('.close-btn').onclick = 
                modalContent.querySelector('.cancel-btn').onclick = () => modal.remove();

                modalContent.querySelector('.export-confirm-btn').onclick = () => {
                    try {
                        const ws = XLSX.utils.json_to_sheet(data);
                        const wb = XLSX.utils.book_new();
                        XLSX.utils.book_append_sheet(wb, ws, "技能賽記錄");
                        XLSX.writeFile(wb, `技能賽記錄_${new Date().toISOString().slice(0,10)}.xlsx`);
                        modal.remove();
                    } catch (error) {
                        alert('導出失敗: ' + error.message);
                    }
                };

                modal.appendChild(modalContent);
                document.body.appendChild(modal);
            }

            // Excel導出功能 - 時間記錄
            function exportToExcel() {
                if (!records.length) {
                    alert('沒有記錄可導出');
                    return;
                }

                const data = prepareExcelData();
                showExportModal(data);
            }

            function prepareExcelData() {
                return records.map(record => ({
                    日期: new Date(record.startTime).toLocaleDateString('zh-Hant'),
                    活動類型: record.type,
                    開始時間: new Date(record.startTime).toLocaleTimeString('zh-Hant', {hour: '2-digit', minute: '2-digit', hour12: false}),
                    結束時間: new Date(record.endTime).toLocaleTimeString('zh-Hant', {hour: '2-digit', minute: '2-digit', hour12: false}),
                    持續時間: record.duration
                }));
            }

            function showExportModal(data) {
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50';

                const modalContent = document.createElement('div');
                modalContent.className = 'export-modal rounded-lg w-full max-w-lg bg-white dark:bg-gray-800';
                
                modalContent.innerHTML = `
                    <div class="export-header px-4 py-3 flex justify-between items-center rounded-t-lg">
                        <h3 class="font-bold text-white">導出時間記錄Excel</h3>
                        <button class="text-white hover:text-gray-200 close-btn">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
                            </svg>
                        </button>
                    </div>
                    <div class="p-4">
                        <div class="preview-container mb-4">
                            <table class="preview-table">
                                <thead>
                                    <tr>${Object.keys(data[0]).map(k => `<th>${k}</th>`).join('')}</tr>
                                </thead>
                                <tbody>
                                    ${data.slice(0, 5).map(row => `
                                        <tr>${Object.values(row).map(v => `<td>${v}</td>`).join('')}</tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                        <div class="flex justify-end space-x-3">
                            <button class="cancel-btn px-4 py-2 rounded bg-gray-200 hover:bg-gray-300">取消</button>
                            <button class="export-confirm-btn px-4 py-2 rounded bg-blue-500 text-white hover:bg-blue-600">
                                <i class="fas fa-download mr-2"></i>導出Excel
                            </button>
                        </div>
                    </div>
                `;

                modalContent.querySelector('.close-btn').onclick = 
                modalContent.querySelector('.cancel-btn').onclick = () => modal.remove();

                modalContent.querySelector('.export-confirm-btn').onclick = () => {
                    try {
                        const ws = XLSX.utils.json_to_sheet(data);
                        const wb = XLSX.utils.book_new();
                        XLSX.utils.book_append_sheet(wb, ws, "時間記錄");
                        XLSX.writeFile(wb, `時間記錄_${new Date().toISOString().slice(0,10)}.xlsx`);
                        modal.remove();
                    } catch (error) {
                        alert('導出失敗: ' + error.message);
                    }
                };

                modal.appendChild(modalContent);
                document.body.appendChild(modal);
            }

            // 啟動系統
            init();
        });
    </script>
</body>
</html>
