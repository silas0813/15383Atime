<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>15383A時間記錄打卡系統</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
	<link rel="icon" type="image/x-icon" href="66163.png">
	<link rel="manifest" href="manifest.json">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <style>
        :root {
            --primary-color: #5D5CDE;
            --active-color: #ff4d4d;
        }

        .light-theme {
            --bg-color: #f5f5f7;
            --card-bg: #ffffff;
            --text-color: #333333;
            --secondary-text: #666666;
            --border-color: #e2e2e2;
            --button-bg: #ffffff;
            --button-border: #e2e2e2;
            --time-display-bg: #f5f5f7;
            --record-bg: #ffffff;
            --tab-active-bg: #ffffff;
            --tab-inactive-bg: #e2e2e2;
            --input-bg: #ffffff;
        }

        .dark-theme {
            --bg-color: #121212;
            --card-bg: #1E1E1E;
            --text-color: #E0E0E0;
            --secondary-text: #AAAAAA;
            --border-color: #444444;
            --button-bg: #333333;
            --button-border: #444444;
            --time-display-bg: #2A2A2A;
            --record-bg: #2A2A2A;
            --tab-active-bg: #2A2A2A;
            --tab-inactive-bg: #444444;
            --input-bg: #333333;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            touch-action: manipulation;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .card {
            background-color: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s ease;
        }

        .activity-btn {
            transition: all 0.2s ease;
            border: 2px solid var(--button-border);
            background-color: var(--button-bg);
            color: var(--text-color);
            font-weight: bold;
            border-radius: 10px;
            font-size: 16px;
        }

        .activity-btn:active {
            transform: scale(0.97);
        }

        .activity-btn.active {
            background-color: var(--active-color);
            color: white;
            border-color: var(--active-color);
        }

        .time-display {
            background-color: var(--time-display-bg);
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            font-weight: bold;
            font-family: monospace;
            font-size: 18px;
            color: var(--primary-color);
            transition: background-color 0.3s ease;
        }

        .dark-theme .time-display {
            color: #00E676;
        }

        .record-item {
            background-color: var(--record-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            transition: background-color 0.3s ease;
        }

        .theme-toggle {
            position: fixed;
            top: 10px;
            right: 10px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            z-index: 10;
            transition: transform 0.3s ease;
        }

        .theme-toggle:active {
            transform: scale(0.95);
        }

        .export-modal {
            background-color: var(--card-bg);
            color: var(--text-color);
            transition: background-color 0.3s ease;
        }

        .export-header {
            background-color: var(--primary-color);
            color: white;
        }

        .preview-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 16px;
            font-size: 14px;
        }

        .preview-table th {
            background-color: var(--primary-color);
            color: white;
            padding: 8px;
            text-align: left;
        }

        .preview-table td {
            padding: 8px;
            border-bottom: 1px solid var(--border-color);
        }

        .dark-theme .preview-table th {
            background-color: #444;
        }

        .preview-container {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            margin-bottom: 16px;
        }

        /* 選項卡樣式 */
        .tab {
            padding: 10px 16px;
            border-radius: 8px 8px 0 0;
            background-color: var(--tab-inactive-bg);
            color: var(--text-color);
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .tab.active {
            background-color: var(--tab-active-bg);
            border-bottom: 3px solid var(--primary-color);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* 表單輸入樣式 */
        .form-input {
            width: 100%;
            padding: 10px 12px;
            background-color: var(--input-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-color);
            font-size: 16px;
            transition: border-color 0.2s ease;
        }

        .form-input:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-color);
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-divider {
            height: 1px;
            background-color: var(--border-color);
            margin: 20px 0;
        }

        .form-section-title {
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--primary-color);
        }

        /* 開關樣式 */
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
            margin-left: 8px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary-color);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        /* 自定義單選按鈕 */
        .radio-container {
            display: flex;
            gap: 10px;
            margin-bottom: 16px;
        }
        
        .radio-btn {
            background-color: var(--button-bg);
            border: 2px solid var(--button-border);
            color: var(--text-color);
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 600;
            text-align: center;
            cursor: pointer;
            flex: 1;
            transition: all 0.2s ease;
        }
        
        .radio-btn.active {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }
    </style>
</head>
<body class="light-theme">
    <button id="themeToggle" class="theme-toggle" aria-label="切換主題">
        <i class="fas fa-moon"></i>
    </button>
    
    <div class="container mx-auto max-w-md p-4 pt-12">
        <h1 class="text-xl font-bold text-center mb-3">15383A時間記錄系統</h1>
        
        <!-- 選項卡導航 -->
        <div class="flex mb-4">
            <div class="tab active" data-tab="timeTracking">時間記錄</div>
            <div class="tab" data-tab="matchRecords">比賽記錄</div>
            <div class="tab" data-tab="skillRecords">技能賽記錄</div>
        </div>
        
        <!-- 時間記錄選項卡 -->
        <div id="timeTracking" class="tab-content active">
            <div class="card p-5 mb-4">
                <div class="time-display mb-4" id="currentTimeDisplay">
                    00:00:00
                </div>
                
                <div class="grid grid-cols-2 gap-3 mb-4" id="activityButtonsContainer">
                    <!-- 按鈕將通過JavaScript動態生成 -->
                </div>
                
                <div class="flex space-x-3">
                    <button id="clearBtn" class="flex-1 bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-4 rounded-lg">
                        清除記錄
                    </button>
                    <button id="exportBtn" class="flex-1 bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg">
                        <i class="fas fa-file-excel mr-1"></i> 導出Excel
                    </button>
                </div>
            </div>
            
            <div class="card p-5">
                <h2 class="text-lg font-bold mb-3">活動記錄</h2>
                <div id="recordsList" class="max-h-96 overflow-y-auto">
                    <div class="text-center text-gray-500 py-4">尚無記錄</div>
                </div>
            </div>
        </div>
        
        <!-- 比賽記錄選項卡 -->
        <div id="matchRecords" class="tab-content">
            <div class="card p-5 mb-4">
                <h2 class="text-lg font-bold mb-3">添加比賽記錄</h2>
                
                <!-- 將日期和場數/回合放在同一行 -->
                <div class="grid grid-cols-2 gap-3">
                    <div class="form-group">
                        <label for="matchDate" class="form-label">比賽日期</label>
                        <input type="date" id="matchDate" class="form-input">
                    </div>
                    <div class="form-group">
                        <label for="matchCount" class="form-label">場數/回合</label>
                        <input type="text" id="matchCount" class="form-input" placeholder="如: 3, R1, A2">
                    </div>
                </div>
                
                <div class="form-divider"></div>
                
                <div class="form-section-title">紅方信息</div>
                <div class="grid grid-cols-2 gap-3">
                    <div class="form-group">
                        <label for="myTeamNumber" class="form-label">紅方1編號/名稱</label>
                        <input type="text" id="myTeamNumber" class="form-input" placeholder="如: A1, Team3">
                    </div>
                    <div class="form-group">
                        <label for="teammateNumber" class="form-label">紅方2編號/名稱</label>
                        <input type="text" id="teammateNumber" class="form-input" placeholder="如: B2, John">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="myTeamScore" class="form-label">紅方分數</label>
                    <input type="number" id="myTeamScore" class="form-input" min="0" placeholder="輸入己方分數">
                </div>
                
                <div class="form-group">
                    <label class="form-label flex items-center justify-between">
                        紅方自動模式獲勝
                        <label class="switch">
                            <input type="checkbox" id="myTeamAutoWin">
                            <span class="slider"></span>
                        </label>
                    </label>
                </div>
                
                <div class="form-divider"></div>
                
                <div class="form-section-title">藍方信息</div>
                <div class="grid grid-cols-2 gap-3">
                    <div class="form-group">
                        <label for="opponentTeam1" class="form-label">藍方1編號/名稱</label>
                        <input type="text" id="opponentTeam1" class="form-input" placeholder="如: C3, TeamX">
                    </div>
                    <div class="form-group">
                        <label for="opponentTeam2" class="form-label">藍方2編號/名稱</label>
                        <input type="text" id="opponentTeam2" class="form-input" placeholder="如: D4, TeamY">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="opponentScore" class="form-label">藍方分數</label>
                    <input type="number" id="opponentScore" class="form-input" min="0" placeholder="輸入對方分數">
                </div>
                
                <div class="form-group">
                    <label class="form-label flex items-center justify-between">
                        藍方自動模式獲勝
                        <label class="switch">
                            <input type="checkbox" id="opponentAutoWin">
                            <span class="slider"></span>
                        </label>
                    </label>
                </div>
                
                <button id="saveMatchBtn" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-lg">
                    保存比賽記錄
                </button>
            </div>
            
            <div class="flex space-x-3 mb-4">
                <button id="clearMatchBtn" class="flex-1 bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-4 rounded-lg">
                    清除記錄
                </button>
                <button id="exportMatchBtn" class="flex-1 bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg">
                    <i class="fas fa-file-excel mr-1"></i> 導出Excel
                </button>
            </div>
            
            <div class="card p-5">
                <h2 class="text-lg font-bold mb-3">比賽記錄列表</h2>
                <div id="matchRecordsList" class="max-h-96 overflow-y-auto">
                    <div class="text-center text-gray-500 py-4">尚無比賽記錄</div>
                </div>
            </div>
        </div>
        
        <!-- 技能賽記錄選項卡 -->
        <div id="skillRecords" class="tab-content">
            <div class="card p-5 mb-4">
                <h2 class="text-lg font-bold mb-3">添加技能賽記錄</h2>
                
                <!-- 將日期和練習開關放在同一行 -->
                <div class="form-group">
                    <div class="flex items-center justify-between">
                        <label for="skillDate" class="form-label">比賽日期</label>
                        <label class="flex items-center">
                            <span class="mr-2 text-sm font-medium">練習</span>
                            <label class="switch">
                                <input type="checkbox" id="isPractice">
                                <span class="slider"></span>
                            </label>
                        </label>
                    </div>
                    <input type="date" id="skillDate" class="form-input">
                </div>
                
                <div class="form-group">
                    <label class="form-label">模式選擇</label>
                    <div class="radio-container">
                        <div class="radio-btn active" data-mode="manual">手動模式</div>
                        <div class="radio-btn" data-mode="auto">自動模式</div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="skillScore" class="form-label">分數</label>
                    <input type="number" id="skillScore" class="form-input" min="0" placeholder="輸入技能賽分數">
                </div>
                
                <div class="form-group">
                    <label for="skillTime" class="form-label">所用時間（秒）</label>
                    <input type="number" id="skillTime" class="form-input" min="0" step="0.1" value="60.0" placeholder="輸入所用時間">
                </div>
                
                <button id="saveSkillBtn" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-lg">
                    保存技能賽記錄
                </button>
            </div>
            
            <div class="flex space-x-3 mb-4">
                <button id="clearSkillBtn" class="flex-1 bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-4 rounded-lg">
                    清除記錄
                </button>
                <button id="exportSkillBtn" class="flex-1 bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg">
                    <i class="fas fa-file-excel mr-1"></i> 導出Excel
                </button>
            </div>
            
            <div class="card p-5">
                <h2 class="text-lg font-bold mb-3">技能賽記錄列表</h2>
                <div id="skillRecordsList" class="max-h-96 overflow-y-auto">
                    <div class="text-center text-gray-500 py-4">尚無技能賽記錄</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 確保DOM完全加載後再執行腳本
        document.addEventListener('DOMContentLoaded', function() {
            // 系統配置
            const activities = [
                '編程', '建造', '練習', 'AWP', 'notebook',
                // 擴展點：在此添加新活動類型
            ];

            // 全局變量
            let records = [];
            let matchRecords = [];
            let skillRecords = [];
            let activeButton = null;
            let startTime = null;
            let currentTheme = 'light';
            let currentTab = 'timeTracking';
            let selectedMode = 'manual';
            
            // 保存用戶偏好設置
            let userPreferences = {
                isPractice: false
            };

            // DOM元素 - 時間記錄相關
            const timeDisplay = document.getElementById('currentTimeDisplay');
            const clearBtn = document.getElementById('clearBtn');
            const exportBtn = document.getElementById('exportBtn');
            const recordsList = document.getElementById('recordsList');
            const themeToggle = document.getElementById('themeToggle');
            const body = document.body;
            const activityButtonsContainer = document.getElementById('activityButtonsContainer');
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');
            
            // DOM元素 - 比賽記錄相關
            const matchDate = document.getElementById('matchDate');
            const myTeamNumber = document.getElementById('myTeamNumber');
            const teammateNumber = document.getElementById('teammateNumber');
            const myTeamScore = document.getElementById('myTeamScore');
            const myTeamAutoWin = document.getElementById('myTeamAutoWin');
            const opponentTeam1 = document.getElementById('opponentTeam1');
            const opponentTeam2 = document.getElementById('opponentTeam2');
            const opponentScore = document.getElementById('opponentScore');
            const opponentAutoWin = document.getElementById('opponentAutoWin');
            const matchCount = document.getElementById('matchCount');
            const saveMatchBtn = document.getElementById('saveMatchBtn');
            const clearMatchBtn = document.getElementById('clearMatchBtn');
            const exportMatchBtn = document.getElementById('exportMatchBtn');
            const matchRecordsList = document.getElementById('matchRecordsList');
            
            // DOM元素 - 技能賽記錄相關
            const skillDate = document.getElementById('skillDate');
            const isPractice = document.getElementById('isPractice');
            const skillScore = document.getElementById('skillScore');
            const skillTime = document.getElementById('skillTime');
            const saveSkillBtn = document.getElementById('saveSkillBtn');
            const clearSkillBtn = document.getElementById('clearSkillBtn');
            const exportSkillBtn = document.getElementById('exportSkillBtn');
            const skillRecordsList = document.getElementById('skillRecordsList');
            const modeBtns = document.querySelectorAll('.radio-btn');
            
            // 加載保存的數據
            loadFromLocalStorage();
            
            // 為每個活動創建按鈕
            activities.forEach(activity => {
                const button = document.createElement('button');
                button.textContent = activity;
                button.className = 'activity-btn p-4';
                button.dataset.activity = activity;
                button.addEventListener('click', function() {
                    handleActivityButtonClick(this);
                });
                activityButtonsContainer.appendChild(button);
            });
            
            // 設置主題切換按鈕事件監聽器
            themeToggle.addEventListener('click', toggleTheme);
            
            // 設置清除按鈕事件監聽器
            clearBtn.addEventListener('click', clearRecords);
            
            // 設置導出按鈕事件監聽器
            exportBtn.addEventListener('click', exportToExcel);
            
            // 設置選項卡切換事件
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    const tabName = tab.dataset.tab;
                    currentTab = tabName;
                    
                    tabContents.forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    document.getElementById(tabName).classList.add('active');
                });
            });
            
            // 設置模式選擇按鈕事件
            modeBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    modeBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    selectedMode = btn.dataset.mode;
                });
            });
            
            // 設置比賽記錄相關按鈕事件
            saveMatchBtn.addEventListener('click', saveMatchRecord);
            clearMatchBtn.addEventListener('click', clearMatchRecords);
            exportMatchBtn.addEventListener('click', exportMatchToExcel);
            
            // 設置技能賽記錄相關按鈕事件
            saveSkillBtn.addEventListener('click', saveSkillRecord);
            clearSkillBtn.addEventListener('click', clearSkillRecords);
            exportSkillBtn.addEventListener('click', exportSkillToExcel);
            
            // 設置當前日期為默認值
            const today = new Date().toISOString().split('T')[0];
            matchDate.value = today;
            skillDate.value = today;
            
            // 每秒更新計時器
            setInterval(updateTimer, 1000);
            
            // 更新UI
            updateUI();
            
            // 函數：處理活動按鈕點擊
            function handleActivityButtonClick(button) {
                // 如果點擊的是當前活動按鈕，則停止記錄
                if (button === activeButton) {
                    stopActivity();
                    return;
                }
                
                // 如果有正在進行的活動，先停止它
                if (activeButton) {
                    stopActivity();
                }
                
                // 啟動新活動
                startActivity(button);
            }
            
            // 函數：開始活動
            function startActivity(button) {
                activeButton = button;
                button.classList.add('active');
                startTime = new Date();
                updateTimer();
            }
            
            // 函數：停止活動
            function stopActivity() {
                if (!activeButton || !startTime) return;
                
                const endTime = new Date();
                const duration = Math.round((endTime - startTime) / 1000); // 秒
                
                // 創建記錄對象
                const record = {
                    activity: activeButton.dataset.activity,
                    startTime: startTime,
                    endTime: endTime,
                    duration: duration
                };
                
                // 添加到記錄數組
                records.push(record);
                
                // 保存到本地存儲
                saveToLocalStorage();
                
                // 更新UI
                updateRecordsList();
                
                // 重置狀態
                activeButton.classList.remove('active');
                activeButton = null;
                startTime = null;
                timeDisplay.textContent = '00:00:00';
            }
            
            // 函數：更新計時器顯示
            function updateTimer() {
                if (!startTime) return;
                
                const currentTime = new Date();
                const elapsedSeconds = Math.floor((currentTime - startTime) / 1000);
                
                const hours = Math.floor(elapsedSeconds / 3600);
                const minutes = Math.floor((elapsedSeconds % 3600) / 60);
                const seconds = elapsedSeconds % 60;
                
                const formattedTime = 
                    String(hours).padStart(2, '0') + ':' +
                    String(minutes).padStart(2, '0') + ':' +
                    String(seconds).padStart(2, '0');
                
                timeDisplay.textContent = formattedTime;
            }
            
            // 函數：更新記錄列表顯示
            function updateRecordsList() {
                if (records.length === 0) {
                    recordsList.innerHTML = '<div class="text-center text-gray-500 py-4">尚無記錄</div>';
                    return;
                }
                
                recordsList.innerHTML = '';
                
                // 排序記錄（從最新到最舊）
                const sortedRecords = [...records].sort((a, b) => b.endTime - a.endTime);
                
                sortedRecords.forEach(record => {
                    const recordItem = document.createElement('div');
                    recordItem.className = 'record-item';
                    
                    const startTimeFormatted = formatDateTime(record.startTime);
                    const endTimeFormatted = formatDateTime(record.endTime);
                    const durationFormatted = formatDuration(record.duration);
                    
                    recordItem.innerHTML = `
                        <div class="flex justify-between items-center">
                            <div class="font-bold">${record.activity}</div>
                            <div class="text-sm text-right">${durationFormatted}</div>
                        </div>
                        <div class="text-sm mt-2">
                            <div>${startTimeFormatted} - ${endTimeFormatted}</div>
                        </div>
                    `;
                    
                    recordsList.appendChild(recordItem);
                });
            }
            
            // 函數：更新比賽記錄列表
            function updateMatchRecordsList() {
                if (matchRecords.length === 0) {
                    matchRecordsList.innerHTML = '<div class="text-center text-gray-500 py-4">尚無比賽記錄</div>';
                    return;
                }
                
                matchRecordsList.innerHTML = '';
                
                // 排序記錄（從最新到最舊）
                const sortedRecords = [...matchRecords].sort((a, b) => {
                    // 按日期倒序排序
                    return new Date(b.date) - new Date(a.date);
                });
                
                sortedRecords.forEach(record => {
                    const recordItem = document.createElement('div');
                    recordItem.className = 'record-item';
                    
                    const redTeam = [record.myTeamNumber, record.teammateNumber]
                        .filter(Boolean)
                        .join(', ');
                    
                    const blueTeam = [record.opponentTeam1, record.opponentTeam2]
                        .filter(Boolean)
                        .join(', ');
                    
                    const redAutoWin = record.myTeamAutoWin ? '自動獲勝' : '';
                    const blueAutoWin = record.opponentAutoWin ? '自動獲勝' : '';
                    
                    recordItem.innerHTML = `
                        <div class="flex justify-between items-center mb-2">
                            <div class="font-bold">${record.date} - ${record.matchCount || '未指定'}</div>
                        </div>
                        <div class="grid grid-cols-2 gap-2 text-sm">
                            <div class="bg-red-100 dark:bg-red-900 p-2 rounded">
                                <div class="font-bold text-red-700 dark:text-red-300">紅方: ${redTeam}</div>
                                <div class="text-gray-800 dark:text-white">分數: ${record.myTeamScore} ${redAutoWin ? `<span class="font-medium">(${redAutoWin})</span>` : ''}</div>
                            </div>
                            <div class="bg-blue-100 dark:bg-blue-900 p-2 rounded">
                                <div class="font-bold text-blue-700 dark:text-blue-300">藍方: ${blueTeam}</div>
                                <div class="text-gray-800 dark:text-white">分數: ${record.opponentScore} ${blueAutoWin ? `<span class="font-medium">(${blueAutoWin})</span>` : ''}</div>
                            </div>
                        </div>
                    `;
                    
                    matchRecordsList.appendChild(recordItem);
                });
            }
            
            // 函數：更新技能賽記錄列表
            function updateSkillRecordsList() {
                if (skillRecords.length === 0) {
                    skillRecordsList.innerHTML = '<div class="text-center text-gray-500 py-4">尚無技能賽記錄</div>';
                    return;
                }
                
                skillRecordsList.innerHTML = '';
                
                // 排序記錄（從最新到最舊）
                const sortedRecords = [...skillRecords].sort((a, b) => {
                    // 按日期倒序排序
                    return new Date(b.date) - new Date(a.date);
                });
                
                sortedRecords.forEach(record => {
                    const recordItem = document.createElement('div');
                    recordItem.className = 'record-item';
                    
                    const isPracticeText = record.isPractice ? ' (練習)' : '';
                    const modeText = record.mode === 'auto' ? '自動模式' : '手動模式';
                    const timeText = record.time ? `所用時間: ${record.time} 秒` : '';
                    
                    recordItem.innerHTML = `
                        <div class="flex justify-between items-center">
                            <div class="font-bold">${record.date}${isPracticeText}</div>
                            <div class="text-sm px-2 py-1 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-white font-medium rounded">${modeText}</div>
                        </div>
                        <div class="mt-2">
                            <div class="text-xl font-bold">${record.score} 分</div>
                            <div class="text-sm">${timeText}</div>
                        </div>
                    `;
                    
                    skillRecordsList.appendChild(recordItem);
                });
            }
            
            // 函數：清除活動記錄
            function clearRecords() {
                if (confirm('確定要清除所有活動記錄嗎？此操作不可撤銷。')) {
                    records = [];
                    saveToLocalStorage();
                    updateRecordsList();
                }
            }
            
            // 函數：清除比賽記錄
            function clearMatchRecords() {
                if (confirm('確定要清除所有比賽記錄嗎？此操作不可撤銷。')) {
                    matchRecords = [];
                    saveToLocalStorage();
                    updateMatchRecordsList();
                }
            }
            
            // 函數：清除技能賽記錄
            function clearSkillRecords() {
                if (confirm('確定要清除所有技能賽記錄嗎？此操作不可撤銷。')) {
                    skillRecords = [];
                    saveToLocalStorage();
                    updateSkillRecordsList();
                }
            }
            
            // 函數：保存比賽記錄
            function saveMatchRecord() {
                const newRecord = {
                    date: matchDate.value,
                    matchCount: matchCount.value,
                    myTeamNumber: myTeamNumber.value,
                    teammateNumber: teammateNumber.value,
                    myTeamScore: myTeamScore.value ? parseInt(myTeamScore.value) : 0,
                    myTeamAutoWin: myTeamAutoWin.checked,
                    opponentTeam1: opponentTeam1.value,
                    opponentTeam2: opponentTeam2.value,
                    opponentScore: opponentScore.value ? parseInt(opponentScore.value) : 0,
                    opponentAutoWin: opponentAutoWin.checked
                };
                
                // 驗證
                if (!newRecord.date) {
                    alert('請選擇比賽日期');
                    return;
                }
                
                if (!newRecord.myTeamNumber && !newRecord.teammateNumber) {
                    alert('請至少填寫一個紅方隊伍信息');
                    return;
                }
                
                if (!newRecord.opponentTeam1 && !newRecord.opponentTeam2) {
                    alert('請至少填寫一個藍方隊伍信息');
                    return;
                }
                
                // 添加記錄
                matchRecords.push(newRecord);
                saveToLocalStorage();
                updateMatchRecordsList();
                
                // 清空表單
                matchCount.value = '';
                myTeamScore.value = '';
                myTeamAutoWin.checked = false;
                opponentScore.value = '';
                opponentAutoWin.checked = false;
                
                alert('比賽記錄已保存');
            }
            
            // 函數：保存技能賽記錄
            function saveSkillRecord() {
                const newRecord = {
                    date: skillDate.value,
                    isPractice: isPractice.checked,
                    mode: selectedMode,
                    score: skillScore.value ? parseInt(skillScore.value) : 0,
                    time: skillTime.value ? parseFloat(skillTime.value) : 1.0
                };
                
                // 驗證
                if (!newRecord.date) {
                    alert('請選擇比賽日期');
                    return;
                }
                
                if (!skillScore.value) {
                    alert('請輸入分數');
                    return;
                }
                
                // 添加記錄
                skillRecords.push(newRecord);
                saveToLocalStorage();
                updateSkillRecordsList();
                
                // 清空表單
                skillScore.value = '';
                // 保留練習模式設置和所用時間的值，因為用戶可能需要連續添加記錄
                
                alert('技能賽記錄已保存');
            }
            
            // 函數：導出活動記錄到Excel
            function exportToExcel() {
                if (records.length === 0) {
                    alert('沒有可導出的活動記錄');
                    return;
                }
                
                // 準備導出數據
                const exportData = records.map(record => {
                    return {
                        '活動類型': record.activity,
                        '開始時間': formatDateTime(record.startTime),
                        '結束時間': formatDateTime(record.endTime),
                        '持續時間(秒)': record.duration,
                        '持續時間': formatDuration(record.duration),
                        '日期': formatDate(record.startTime)
                    };
                });
                
                // 創建工作簿和工作表
                const wb = XLSX.utils.book_new();
                const ws = XLSX.utils.json_to_sheet(exportData);
                
                // 添加工作表到工作簿
                XLSX.utils.book_append_sheet(wb, ws, '活動記錄');
                
                // 導出Excel文件
                XLSX.writeFile(wb, '活動記錄_' + new Date().toISOString().split('T')[0] + '.xlsx');
            }
            
            // 函數：導出比賽記錄到Excel
            function exportMatchToExcel() {
                if (matchRecords.length === 0) {
                    alert('沒有可導出的比賽記錄');
                    return;
                }
                
                // 準備導出數據
                const exportData = matchRecords.map(record => {
                    return {
                        '日期': record.date,
                        '場次/回合': record.matchCount || '未指定',
                        '紅方1': record.myTeamNumber || '',
                        '紅方2': record.teammateNumber || '',
                        '紅方分數': record.myTeamScore,
                        '紅方自動獲勝': record.myTeamAutoWin ? '是' : '否',
                        '藍方1': record.opponentTeam1 || '',
                        '藍方2': record.opponentTeam2 || '',
                        '藍方分數': record.opponentScore,
                        '藍方自動獲勝': record.opponentAutoWin ? '是' : '否',
                        '結果': record.myTeamScore > record.opponentScore ? '紅方獲勝' : 
                               record.myTeamScore < record.opponentScore ? '藍方獲勝' : '平局'
                    };
                });
                
                // 創建工作簿和工作表
                const wb = XLSX.utils.book_new();
                const ws = XLSX.utils.json_to_sheet(exportData);
                
                // 添加工作表到工作簿
                XLSX.utils.book_append_sheet(wb, ws, '比賽記錄');
                
                // 導出Excel文件
                XLSX.writeFile(wb, '比賽記錄_' + new Date().toISOString().split('T')[0] + '.xlsx');
            }
            
            // 函數：導出技能賽記錄到Excel
            function exportSkillToExcel() {
                if (skillRecords.length === 0) {
                    alert('沒有可導出的技能賽記錄');
                    return;
                }
                
                // 準備導出數據
                const exportData = skillRecords.map(record => {
                    return {
                        '日期': record.date,
                        '類型': record.isPractice ? '練習' : '比賽',
                        '模式': record.mode === 'auto' ? '自動模式' : '手動模式',
                        '分數': record.score,
                        '所用時間(秒)': record.time || 60.0
                    };
                });
                
                // 創建工作簿和工作表
                const wb = XLSX.utils.book_new();
                const ws = XLSX.utils.json_to_sheet(exportData);
                
                // 添加工作表到工作簿
                XLSX.utils.book_append_sheet(wb, ws, '技能賽記錄');
                
                // 導出Excel文件
                XLSX.writeFile(wb, '技能賽記錄_' + new Date().toISOString().split('T')[0] + '.xlsx');
            }
            
            // 函數：格式化日期時間
            function formatDateTime(date) {
                const d = new Date(date);
                return d.toLocaleString('zh-TW', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: false
                });
            }
            
            // 函數：格式化日期
            function formatDate(date) {
                const d = new Date(date);
                return d.toLocaleDateString('zh-TW', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit'
                });
            }
            
            // 函數：格式化持續時間
            function formatDuration(seconds) {
                const hours = Math.floor(seconds / 3600);
                const minutes = Math.floor((seconds % 3600) / 60);
                const remainingSeconds = seconds % 60;
                
                return (hours > 0 ? hours + '小時 ' : '') +
                       (minutes > 0 ? minutes + '分鐘 ' : '') +
                       remainingSeconds + '秒';
            }
            
            // 函數：切換主題
            function toggleTheme() {
                if (currentTheme === 'light') {
                    body.classList.remove('light-theme');
                    body.classList.add('dark-theme');
                    themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
                    currentTheme = 'dark';
                } else {
                    body.classList.remove('dark-theme');
                    body.classList.add('light-theme');
                    themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
                    currentTheme = 'light';
                }
                
                // 保存主題設置
                localStorage.setItem('15383A_theme', currentTheme);
            }
            
            // 函數：保存到本地存儲
            function saveToLocalStorage() {
                try {
                    localStorage.setItem('15383A_records', JSON.stringify(records));
                    localStorage.setItem('15383A_matchRecords', JSON.stringify(matchRecords));
                    localStorage.setItem('15383A_skillRecords', JSON.stringify(skillRecords));
                    localStorage.setItem('15383A_userPreferences', JSON.stringify(userPreferences));
                } catch (e) {
                    console.error('保存到本地存儲時出錯：', e);
                }
            }
            
            // 函數：從本地存儲加載
            function loadFromLocalStorage() {
                try {
                    // 加載記錄
                    const savedRecords = localStorage.getItem('15383A_records');
                    if (savedRecords) {
                        records = JSON.parse(savedRecords);
                        // 將字符串日期轉換為Date對象
                        records.forEach(record => {
                            record.startTime = new Date(record.startTime);
                            record.endTime = new Date(record.endTime);
                        });
                    }
                    
                    // 加載比賽記錄
                    const savedMatchRecords = localStorage.getItem('15383A_matchRecords');
                    if (savedMatchRecords) {
                        matchRecords = JSON.parse(savedMatchRecords);
                    }
                    
                    // 加載技能賽記錄
                    const savedSkillRecords = localStorage.getItem('15383A_skillRecords');
                    if (savedSkillRecords) {
                        skillRecords = JSON.parse(savedSkillRecords);
                    }
                    
                    // 加載用戶偏好設置
                    const savedPreferences = localStorage.getItem('15383A_userPreferences');
                    if (savedPreferences) {
                        userPreferences = JSON.parse(savedPreferences);
                        isPractice.checked = userPreferences.isPractice;
                    }
                    
                    // 加載主題
                    const savedTheme = localStorage.getItem('15383A_theme');
                    if (savedTheme) {
                        currentTheme = savedTheme;
                        if (currentTheme === 'dark') {
                            body.classList.remove('light-theme');
                            body.classList.add('dark-theme');
                            themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
                        }
                    }
                    
                } catch (e) {
                    console.error('從本地存儲加載時出錯：', e);
                }
            }
            
            // 函數：更新UI
            function updateUI() {
                updateRecordsList();
                updateMatchRecordsList();
                updateSkillRecordsList();
            }
            
            // 監聽練習模式開關變化
            isPractice.addEventListener('change', function() {
                userPreferences.isPractice = this.checked;
                saveToLocalStorage();
            });
            
            // 適配深色模式
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches && currentTheme === 'light') {
                toggleTheme();
            }
        });
    </script>
</body>
</html>
