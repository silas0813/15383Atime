<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>15383A時間記錄打卡系統</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="manifest" herf="manifest.json">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
	<link rel="icon" type="image/x-icon" href="img/icon8.png">
	<link rel="manifest" href="manifest.json">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <style>
        :root {
            --primary-color: #5D5CDE;
            --active-color: #ff4d4d;
        }

        .light-theme {
            --bg-color: #f5f5f7;
            --card-bg: #ffffff;
            --text-color: #333333;
            --secondary-text: #666666;
            --border-color: #e2e2e2;
            --button-bg: #ffffff;
            --button-border: #e2e2e2;
            --time-display-bg: #f5f5f7;
            --record-bg: #ffffff;
            --tab-active-bg: #ffffff;
            --tab-inactive-bg: #e2e2e2;
            --input-bg: #ffffff;
        }

        .dark-theme {
            --bg-color: #121212;
            --card-bg: #1E1E1E;
            --text-color: #E0E0E0;
            --secondary-text: #AAAAAA;
            --border-color: #444444;
            --button-bg: #333333;
            --button-border: #444444;
            --time-display-bg: #2A2A2A;
            --record-bg: #2A2A2A;
            --tab-active-bg: #2A2A2A;
            --tab-inactive-bg: #444444;
            --input-bg: #333333;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            touch-action: manipulation;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .card {
            background-color: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s ease;
        }

        .activity-btn {
            transition: all 0.2s ease;
            border: 2px solid var(--button-border);
            background-color: var(--button-bg);
            color: var(--text-color);
            font-weight: bold;
            border-radius: 10px;
            font-size: 16px;
        }

        .activity-btn:active {
            transform: scale(0.97);
        }

        .activity-btn.active {
            background-color: var(--active-color);
            color: white;
            border-color: var(--active-color);
        }

        .time-display {
            background-color: var(--time-display-bg);
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            font-weight: bold;
            font-family: monospace;
            font-size: 18px;
            color: var(--primary-color);
            transition: background-color 0.3s ease;
        }

        .dark-theme .time-display {
            color: #00E676;
        }

        .record-item {
            background-color: var(--record-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            transition: background-color 0.3s ease;
        }

        .theme-toggle {
            position: fixed;
            top: 10px;
            right: 10px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            z-index: 10;
            transition: transform 0.3s ease;
        }

        .theme-toggle:active {
            transform: scale(0.95);
        }

        .export-modal {
            background-color: var(--card-bg);
            color: var(--text-color);
            transition: background-color 0.3s ease;
        }

        .export-header {
            background-color: var(--primary-color);
            color: white;
        }

        .preview-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 16px;
            font-size: 14px;
        }

        .preview-table th {
            background-color: var(--primary-color);
            color: white;
            padding: 8px;
            text-align: left;
        }

        .preview-table td {
            padding: 8px;
            border-bottom: 1px solid var(--border-color);
        }

        .dark-theme .preview-table th {
            background-color: #444;
        }

        .preview-container {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            margin-bottom: 16px;
        }

        /* 選項卡樣式 */
        .tab {
            padding: 10px 16px;
            border-radius: 8px 8px 0 0;
            background-color: var(--tab-inactive-bg);
            color: var(--text-color);
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .tab.active {
            background-color: var(--tab-active-bg);
            border-bottom: 3px solid var(--primary-color);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* 表單輸入樣式 */
        .form-input {
            width: 100%;
            padding: 10px 12px;
            background-color: var(--input-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-color);
            font-size: 16px;
            transition: border-color 0.2s ease;
        }

        .form-input:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-color);
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-divider {
            height: 1px;
            background-color: var(--border-color);
            margin: 20px 0;
        }

        .form-section-title {
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--primary-color);
        }

        /* 開關樣式 */
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
            margin-left: 8px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary-color);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        /* 自定義單選按鈕 */
        .radio-container {
            display: flex;
            gap: 10px;
            margin-bottom: 16px;
        }
        
        .radio-btn {
            background-color: var(--button-bg);
            border: 2px solid var(--button-border);
            color: var(--text-color);
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 600;
            text-align: center;
            cursor: pointer;
            flex: 1;
            transition: all 0.2s ease;
        }
        
        .radio-btn.active {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }
    </style>
</head>
<body class="light-theme">
    <button id="themeToggle" class="theme-toggle" aria-label="切換主題">
        <i class="fas fa-moon"></i>
    </button>
    
    <div class="container mx-auto max-w-md p-4 pt-12">
        <h1 class="text-xl font-bold text-center mb-3">15383A時間記錄系統</h1>
        
        <!-- 選項卡導航 -->
        <div class="flex mb-4">
            <div class="tab active" data-tab="timeTracking">時間記錄</div>
            <div class="tab" data-tab="matchRecords">比賽記錄</div>
            <div class="tab" data-tab="skillRecords">技能賽記錄</div>
        </div>
        
        <!-- 時間記錄選項卡 -->
        <div id="timeTracking" class="tab-content active">
            <div class="card p-5 mb-4">
                <div class="time-display mb-4" id="currentTimeDisplay">
                    00:00:00
                </div>
                
                <div class="grid grid-cols-2 gap-3 mb-4" id="activityButtonsContainer">
                    <!-- 按鈕將通過JavaScript動態生成 -->
                </div>
                
                <div class="flex space-x-3">
                    <button id="clearBtn" class="flex-1 bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-4 rounded-lg">
                        清除記錄
                    </button>
                    <button id="exportBtn" class="flex-1 bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg">
                        <i class="fas fa-file-excel mr-1"></i> 導出Excel
                    </button>
                </div>
            </div>
            
            <div class="card p-5">
                <h2 class="text-lg font-bold mb-3">活動記錄</h2>
                <div id="recordsList" class="max-h-96 overflow-y-auto">
                    <div class="text-center text-gray-500 py-4">尚無記錄</div>
                </div>
            </div>
        </div>
        
        <!-- 比賽記錄選項卡 -->
        <div id="matchRecords" class="tab-content">
            <div class="card p-5 mb-4">
                <h2 class="text-lg font-bold mb-3">添加比賽記錄</h2>
                
                <div class="form-group">
                    <label for="matchDate" class="form-label">比賽日期</label>
                    <input type="date" id="matchDate" class="form-input">
                </div>
                
                <div class="form-divider"></div>
                
                <div class="form-section-title">己方信息</div>
                <div class="grid grid-cols-2 gap-3">
                    <div class="form-group">
                        <label for="myTeamNumber" class="form-label">己方隊伍編號/名稱</label>
                        <input type="text" id="myTeamNumber" class="form-input" placeholder="如: A1, Team3">
                    </div>
                    <div class="form-group">
                        <label for="teammateNumber" class="form-label">隊友編號/名稱</label>
                        <input type="text" id="teammateNumber" class="form-input" placeholder="如: B2, John">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="myTeamScore" class="form-label">己方分數</label>
                    <input type="number" id="myTeamScore" class="form-input" min="0" placeholder="輸入己方分數">
                </div>
                
                <div class="form-divider"></div>
                
                <div class="form-section-title">對方信息</div>
                <div class="grid grid-cols-2 gap-3">
                    <div class="form-group">
                        <label for="opponentTeam1" class="form-label">對方隊伍1編號/名稱</label>
                        <input type="text" id="opponentTeam1" class="form-input" placeholder="如: C3, TeamX">
                    </div>
                    <div class="form-group">
                        <label for="opponentTeam2" class="form-label">對方隊伍2編號/名稱</label>
                        <input type="text" id="opponentTeam2" class="form-input" placeholder="如: D4, TeamY">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="opponentScore" class="form-label">對方分數</label>
                    <input type="number" id="opponentScore" class="form-input" min="0" placeholder="輸入對方分數">
                </div>
                
                <div class="form-divider"></div>
                
                <div class="form-group">
                    <label for="matchCount" class="form-label">場數/回合</label>
                    <input type="text" id="matchCount" class="form-input" placeholder="輸入場數或回合 (如: 3, R1, A2)">
                </div>
                
                <div class="form-group">
                    <label class="form-label flex items-center justify-between">
                        自動模式獲勝
                        <label class="switch">
                            <input type="checkbox" id="autoWin">
                            <span class="slider"></span>
                        </label>
                    </label>
                </div>
                
                <button id="saveMatchBtn" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-lg">
                    保存比賽記錄
                </button>
            </div>
            
            <div class="flex space-x-3 mb-4">
                <button id="clearMatchBtn" class="flex-1 bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-4 rounded-lg">
                    清除記錄
                </button>
                <button id="exportMatchBtn" class="flex-1 bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg">
                    <i class="fas fa-file-excel mr-1"></i> 導出Excel
                </button>
            </div>
            
            <div class="card p-5">
                <h2 class="text-lg font-bold mb-3">比賽記錄列表</h2>
                <div id="matchRecordsList" class="max-h-96 overflow-y-auto">
                    <div class="text-center text-gray-500 py-4">尚無比賽記錄</div>
                </div>
            </div>
        </div>
        
        <!-- 技能賽記錄選項卡 -->
        <div id="skillRecords" class="tab-content">
            <div class="card p-5 mb-4">
                <h2 class="text-lg font-bold mb-3">添加技能賽記錄</h2>
                
                <div class="form-group">
                    <label for="skillDate" class="form-label">比賽日期</label>
                    <input type="date" id="skillDate" class="form-input">
                </div>
                
                <div class="form-group">
                    <label class="form-label">模式選擇</label>
                    <div class="radio-container">
                        <div class="radio-btn active" data-mode="manual">手動模式</div>
                        <div class="radio-btn" data-mode="auto">自動模式</div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="skillScore" class="form-label">分數</label>
                    <input type="number" id="skillScore" class="form-input" min="0" placeholder="輸入技能賽分數">
                </div>
                
                <button id="saveSkillBtn" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-lg">
                    保存技能賽記錄
                </button>
            </div>
            
            <div class="flex space-x-3 mb-4">
                <button id="clearSkillBtn" class="flex-1 bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-4 rounded-lg">
                    清除記錄
                </button>
                <button id="exportSkillBtn" class="flex-1 bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg">
                    <i class="fas fa-file-excel mr-1"></i> 導出Excel
                </button>
            </div>
            
            <div class="card p-5">
                <h2 class="text-lg font-bold mb-3">技能賽記錄列表</h2>
                <div id="skillRecordsList" class="max-h-96 overflow-y-auto">
                    <div class="text-center text-gray-500 py-4">尚無技能賽記錄</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 系統配置
        const activities = [
            '編程', '建造', '練習', 'AWP', 'notebook',
            // 擴展點：在此添加新活動類型
        ];

        // 全局變量
        let records = [];
        let matchRecords = [];
        let skillRecords = [];
        let activeButton = null;
        let startTime = null;
        let currentTheme = 'light';
        let currentTab = 'timeTracking';
        let selectedMode = 'manual';

        // DOM元素
        const timeDisplay = document.getElementById('currentTimeDisplay');
        const clearBtn = document.getElementById('clearBtn');
        const exportBtn = document.getElementById('exportBtn');
        const recordsList = document.getElementById('recordsList');
        const themeToggle = document.getElementById('themeToggle');
        const body = document.body;
        const activityButtonsContainer = document.getElementById('activityButtonsContainer');
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        
        // 比賽記錄DOM元素
        const matchDate = document.getElementById('matchDate');
        const myTeamNumber = document.getElementById('myTeamNumber');
        const teammateNumber = document.getElementById('teammateNumber');
        const myTeamScore = document.getElementById('myTeamScore');
        const opponentTeam1 = document.getElementById('opponentTeam1');
        const opponentTeam2 = document.getElementById('opponentTeam2');
        const opponentScore = document.getElementById('opponentScore');
        const matchCount = document.getElementById('matchCount');
        const autoWin = document.getElementById('autoWin');
        const saveMatchBtn = document.getElementById('saveMatchBtn');
        const clearMatchBtn = document.getElementById('clearMatchBtn');
        const exportMatchBtn = document.getElementById('exportMatchBtn');
        const matchRecordsList = document.getElementById('matchRecordsList');
        
        // 技能賽DOM元素
        const skillDate = document.getElementById('skillDate');
        const radioButtons = document.querySelectorAll('.radio-btn');
        const skillScore = document.getElementById('skillScore');
        const saveSkillBtn = document.getElementById('saveSkillBtn');
        const clearSkillBtn = document.getElementById('clearSkillBtn');
        const exportSkillBtn = document.getElementById('exportSkillBtn');
        const skillRecordsList = document.getElementById('skillRecordsList');

        // 初始化
        function init() {
            renderActivityButtons();
            loadRecords();
            loadMatchRecords();
            loadSkillRecords();
            loadThemePreference();
            
            // 設置今天日期
            const today = new Date().toISOString().split('T')[0];
            matchDate.value = today;
            skillDate.value = today;
            
            updateTimeDisplay();
            setInterval(updateTimeDisplay, 1000);

            // 事件監聽器
            activityButtonsContainer.addEventListener('click', handleAct
