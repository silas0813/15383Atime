<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>15383A時間記錄打卡系統</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
	<link rel="icon" type="image/x-icon" href="66163.png">
	<link rel="manifest" href="manifest.json">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <style>
        :root {
            --primary-color: #5D5CDE;
            --active-color: #ff4d4d;
        }

        .light-theme {
            --bg-color: #f5f5f7;
            --card-bg: #ffffff;
            --text-color: #333333;
            --secondary-text: #666666;
            --border-color: #e2e2e2;
            --button-bg: #ffffff;
            --button-border: #e2e2e2;
            --time-display-bg: #f5f5f7;
            --record-bg: #ffffff;
            --tab-active-bg: #ffffff;
            --tab-inactive-bg: #e2e2e2;
            --input-bg: #ffffff;
        }

        .dark-theme {
            --bg-color: #121212;
            --card-bg: #1E1E1E;
            --text-color: #E0E0E0;
            --secondary-text: #AAAAAA;
            --border-color: #444444;
            --button-bg: #333333;
            --button-border: #444444;
            --time-display-bg: #2A2A2A;
            --record-bg: #2A2A2A;
            --tab-active-bg: #2A2A2A;
            --tab-inactive-bg: #444444;
            --input-bg: #333333;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            touch-action: manipulation;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .card {
            background-color: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s ease;
        }

        .activity-btn {
            transition: all 0.2s ease;
            border: 2px solid var(--button-border);
            background-color: var(--button-bg);
            color: var(--text-color);
            font-weight: bold;
            border-radius: 10px;
            font-size: 16px;
        }

        .activity-btn:active {
            transform: scale(0.97);
        }

        .activity-btn.active {
            background-color: var(--active-color);
            color: white;
            border-color: var(--active-color);
        }

        .time-display {
            background-color: var(--time-display-bg);
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            font-weight: bold;
            font-family: monospace;
            font-size: 18px;
            color: var(--primary-color);
            transition: background-color 0.3s ease;
        }

        .dark-theme .time-display {
            color: #00E676;
        }

        .record-item {
            background-color: var(--record-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            transition: background-color 0.3s ease;
        }

        .theme-toggle {
            position: fixed;
            top: 10px;
            right: 10px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            z-index: 10;
            transition: transform 0.3s ease;
        }

        .theme-toggle:active {
            transform: scale(0.95);
        }

        .export-modal {
            background-color: var(--card-bg);
            color: var(--text-color);
            transition: background-color 0.3s ease;
        }

        .export-header {
            background-color: var(--primary-color);
            color: white;
        }

        .preview-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 16px;
            font-size: 14px;
        }

        .preview-table th {
            background-color: var(--primary-color);
            color: white;
            padding: 8px;
            text-align: left;
        }

        .preview-table td {
            padding: 8px;
            border-bottom: 1px solid var(--border-color);
        }

        .dark-theme .preview-table th {
            background-color: #444;
        }

        .preview-container {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            margin-bottom: 16px;
        }

        /* 選項卡樣式 */
        .tab {
            padding: 10px 16px;
            border-radius: 8px 8px 0 0;
            background-color: var(--tab-inactive-bg);
            color: var(--text-color);
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .tab.active {
            background-color: var(--tab-active-bg);
            border-bottom: 3px solid var(--primary-color);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* 表單輸入樣式 */
        .form-input {
            width: 100%;
            padding: 10px 12px;
            background-color: var(--input-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-color);
            font-size: 16px;
            transition: border-color 0.2s ease;
        }

        .form-input:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-color);
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-divider {
            height: 1px;
            background-color: var(--border-color);
            margin: 20px 0;
        }

        .form-section-title {
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--primary-color);
        }

        /* 開關樣式 */
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
            margin-left: 8px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary-color);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        /* 自定義單選按鈕 */
        .radio-container {
            display: flex;
            gap: 10px;
            margin-bottom: 16px;
        }
        
        .radio-btn {
            background-color: var(--button-bg);
            border: 2px solid var(--button-border);
            color: var(--text-color);
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 600;
            text-align: center;
            cursor: pointer;
            flex: 1;
            transition: all 0.2s ease;
        }
        
        .radio-btn.active {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }

        /* 計時器及秒錶樣式 */
        .timer-container {
            position: relative;
            overflow: hidden;
            background-color: #232329;
            border-radius: 12px;
            color: white;
        }

        .timer-tabs {
            display: flex;
            padding: 15px;
            background-color: #232329;
            position: relative;
            justify-content: center;
        }

        .timer-tab-options {
            display: flex;
            background-color: #383842;
            border-radius: 30px;
            padding: 4px;
        }

        .timer-tab {
            padding: 8px 20px;
            border-radius: 25px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s ease;
            font-size: 16px;
            text-align: center;
        }

        .timer-tab.active {
            background-color: #4D5AB3;
        }

        .timer-controls {
            position: absolute;
            right: 15px;
            display: flex;
            align-items: center;
        }

        .timer-control-btn {
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            padding: 5px;
            opacity: 0.7;
            transition: opacity 0.2s ease;
        }

        .timer-control-btn:hover {
            opacity: 1;
        }

        .timer-circle-container {
            position: relative;
            width: 280px;
            height: 280px;
            margin: 20px auto 40px;
        }

        .timer-circle-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background-color: #2A2A33;
            border: 10px solid #3A3A45;
            box-sizing: border-box;
        }

        .timer-circle-progress {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            clip: rect(0, 280px, 280px, 140px);
            background-color: transparent;
        }

        .timer-circle-indicator {
            position: absolute;
            top: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background-color: transparent;
            transform: rotate(0deg);
        }

        .timer-circle-indicator:before {
            content: '';
            position: absolute;
            top: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 10px;
            height: 10px;
            background-color: white;
            border-radius: 50%;
        }

        .timer-display {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 60px; /* Reduced from 70px */
            font-weight: 300;
            color: white;
            text-align: center;
            font-family: 'Courier New', monospace;
            letter-spacing: 0; /* Removed letter spacing */
            width: 90%; /* Limit width to ensure text stays within container */
            white-space: nowrap; /* Keep text on single line */
        }

        .timer-action-buttons {
            display: flex;
            justify-content: center;
            padding: 0 10px;
            margin-bottom: 20px;
            gap: 15px;
        }

        .timer-action-btn {
            width: 45%;
            padding: 15px 0;
            border-radius: 50px;
            font-size: 16px;
            font-weight: bold;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s ease;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .timer-pause-btn {
            background-color: #3A3A45;
        }

        .timer-reset-btn {
            background-color: #3A3A45;
        }

        .timer-action-btn i {
            margin-right: 8px;
        }

        .stopwatch-lap-list {
            max-height: 150px;
            overflow-y: auto;
            width: 100%;
            margin: 0 auto 20px;
            padding: 0 20px;
        }

        .stopwatch-lap-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            font-family: 'Courier New', monospace;
        }

        .stopwatch-lap-number {
            font-weight: bold;
            color: #91A7FF;
        }

        .timer-fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 9999;
            background-color: #232329;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* Hide scrollbar for Chrome, Safari and Opera */
        .stopwatch-lap-list::-webkit-scrollbar {
            display: none;
        }

        /* Hide scrollbar for IE, Edge and Firefox */
        .stopwatch-lap-list {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
    </style>
</head>
<body class="light-theme">
    <button id="themeToggle" class="theme-toggle" aria-label="切換主題">
        <i class="fas fa-moon"></i>
    </button>
    
    <div class="container mx-auto max-w-md p-4 pt-12">
        <h1 class="text-xl font-bold text-center mb-3">15383A時間記錄系統</h1>
        
        <!-- 選項卡導航 -->
        <div class="flex mb-4">
            <div class="tab active" data-tab="timeTracking">時間記錄</div>
            <div class="tab" data-tab="matchRecords">比賽記錄</div>
            <div class="tab" data-tab="skillRecords">技能賽記錄</div>
            <div class="tab" data-tab="timerStopwatch">計時器及秒錶</div>
        </div>
        
        <!-- 時間記錄選項卡 -->
        <div id="timeTracking" class="tab-content active">
            <div class="card p-5 mb-4">
                <div class="time-display mb-4" id="currentTimeDisplay">
                    00:00:00
                </div>
                
                <div class="grid grid-cols-2 gap-3 mb-4" id="activityButtonsContainer">
                    <!-- 按鈕將通過JavaScript動態生成 -->
                </div>
                
                <div class="flex space-x-3">
                    <button id="clearBtn" class="flex-1 bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-4 rounded-lg">
                        清除記錄
                    </button>
                    <button id="exportBtn" class="flex-1 bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg">
                        <i class="fas fa-file-excel mr-1"></i> 導出Excel
                    </button>
                </div>
            </div>
            
            <div class="card p-5">
                <h2 class="text-lg font-bold mb-3">活動記錄</h2>
                <div id="recordsList" class="max-h-96 overflow-y-auto">
                    <div class="text-center text-gray-500 py-4">尚無記錄</div>
                </div>
            </div>
        </div>
        
        <!-- 比賽記錄選項卡 -->
        <div id="matchRecords" class="tab-content">
            <div class="card p-5 mb-4">
                <h2 class="text-lg font-bold mb-3">添加比賽記錄</h2>
                
                <!-- 將日期和場數/回合放在同一行 -->
                <div class="grid grid-cols-2 gap-3">
                    <div class="form-group">
                        <label for="matchDate" class="form-label">比賽日期</label>
                        <input type="date" id="matchDate" class="form-input">
                    </div>
                    <div class="form-group">
                        <label for="matchCount" class="form-label">場數/回合</label>
                        <input type="text" id="matchCount" class="form-input" placeholder="如: 3, R1, A2">
                    </div>
                </div>
                
                <div class="form-divider"></div>
                
                <div class="form-section-title">紅方信息</div>
                <div class="grid grid-cols-2 gap-3">
                    <div class="form-group">
                        <label for="myTeamNumber" class="form-label">紅方1編號/名稱</label>
                        <input type="text" id="myTeamNumber" class="form-input" placeholder="如: A1, Team3">
                    </div>
                    <div class="form-group">
                        <label for="teammateNumber" class="form-label">紅方2編號/名稱</label>
                        <input type="text" id="teammateNumber" class="form-input" placeholder="如: B2, John">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="myTeamScore" class="form-label">紅方分數</label>
                    <input type="number" id="myTeamScore" class="form-input" min="0" placeholder="輸入己方分數">
                </div>
                
                <div class="form-group">
                    <label class="form-label flex items-center justify-between">
                        紅方自動模式獲勝
                        <label class="switch">
                            <input type="checkbox" id="myTeamAutoWin">
                            <span class="slider"></span>
                        </label>
                    </label>
                </div>
                
                <div class="form-divider"></div>
                
                <div class="form-section-title">藍方信息</div>
                <div class="grid grid-cols-2 gap-3">
                    <div class="form-group">
                        <label for="opponentTeam1" class="form-label">藍方1編號/名稱</label>
                        <input type="text" id="opponentTeam1" class="form-input" placeholder="如: C3, TeamX">
                    </div>
                    <div class="form-group">
                        <label for="opponentTeam2" class="form-label">藍方2編號/名稱</label>
                        <input type="text" id="opponentTeam2" class="form-input" placeholder="如: D4, TeamY">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="opponentScore" class="form-label">藍方分數</label>
                    <input type="number" id="opponentScore" class="form-input" min="0" placeholder="輸入對方分數">
                </div>
                
                <div class="form-group">
                    <label class="form-label flex items-center justify-between">
                        藍方自動模式獲勝
                        <label class="switch">
                            <input type="checkbox" id="opponentAutoWin">
                            <span class="slider"></span>
                        </label>
                    </label>
                </div>
                
                <button id="saveMatchBtn" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-lg">
                    保存比賽記錄
                </button>
            </div>
            
            <div class="flex space-x-3 mb-4">
                <button id="clearMatchBtn" class="flex-1 bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-4 rounded-lg">
                    清除記錄
                </button>
                <button id="exportMatchBtn" class="flex-1 bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg">
                    <i class="fas fa-file-excel mr-1"></i> 導出Excel
                </button>
            </div>
            
            <div class="card p-5">
                <h2 class="text-lg font-bold mb-3">比賽記錄列表</h2>
                <div id="matchRecordsList" class="max-h-96 overflow-y-auto">
                    <div class="text-center text-gray-500 py-4">尚無比賽記錄</div>
                </div>
            </div>
        </div>
        
        <!-- 技能賽記錄選項卡 -->
        <div id="skillRecords" class="tab-content">
            <div class="card p-5 mb-4">
                <h2 class="text-lg font-bold mb-3">添加技能賽記錄</h2>
                
                <!-- 將日期和練習開關放在同一行 -->
                <div class="form-group">
                    <div class="flex items-center justify-between">
                        <label for="skillDate" class="form-label">比賽日期</label>
                        <label class="flex items-center">
                            <span class="mr-2 text-sm font-medium">練習</span>
                            <label class="switch">
                                <input type="checkbox" id="isPractice">
                                <span class="slider"></span>
                            </label>
                        </label>
                    </div>
                    <input type="date" id="skillDate" class="form-input">
                </div>
                
                <div class="form-group">
                    <label class="form-label">模式選擇</label>
                    <div class="radio-container">
                        <div class="radio-btn active" data-mode="manual">手動模式</div>
                        <div class="radio-btn" data-mode="auto">自動模式</div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="skillScore" class="form-label">分數</label>
                    <input type="number" id="skillScore" class="form-input" min="0" placeholder="輸入技能賽分數">
                </div>
                
                <div class="form-group">
                    <label for="skillTime" class="form-label">所用時間（秒）</label>
                    <input type="number" id="skillTime" class="form-input" min="0" step="0.1" value="60.0" placeholder="輸入所用時間">
                </div>
                
                <button id="saveSkillBtn" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-lg">
                    保存技能賽記錄
                </button>
            </div>
            
            <div class="flex space-x-3 mb-4">
                <button id="clearSkillBtn" class="flex-1 bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-4 rounded-lg">
                    清除記錄
                </button>
                <button id="exportSkillBtn" class="flex-1 bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg">
                    <i class="fas fa-file-excel mr-1"></i> 導出Excel
                </button>
            </div>
            
            <div class="card p-5">
                <h2 class="text-lg font-bold mb-3">技能賽記錄列表</h2>
                <div id="skillRecordsList" class="max-h-96 overflow-y-auto">
                    <div class="text-center text-gray-500 py-4">尚無技能賽記錄</div>
                </div>
            </div>
        </div>
        
        <!-- 計時器及秒錶選項卡 -->
        <div id="timerStopwatch" class="tab-content">
            <div class="timer-container">
                <div class="timer-tabs">
                    <div class="timer-tab-options">
                        <div class="timer-tab active" id="timerTab">計時器</div>
                        <div class="timer-tab" id="stopwatchTab">秒錶</div>
                    </div>
                    <div class="timer-controls">
                        <button class="timer-control-btn" id="soundToggle" aria-label="聲音開關">
                            <i class="fas fa-volume-up"></i>
                        </button>
                        <button class="timer-control-btn" id="fullscreenToggle" aria-label="全屏切換">
                            <i class="fas fa-expand"></i>
                        </button>
                    </div>
                </div>
                
                <div class="timer-content">
                    <!-- Timer Circle -->
                    <div class="timer-circle-container">
                        <div class="timer-circle-bg"></div>
                        <div class="timer-circle-progress" id="timerProgress"></div>
                        <div class="timer-circle-indicator" id="timerIndicator"></div>
                        <div class="timer-display" id="timeDisplay">1:00</div>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="timer-action-buttons">
                        <button class="timer-action-btn timer-pause-btn" id="pauseBtn">
                            <i class="fas fa-play"></i> 開始
                        </button>
                        <button class="timer-action-btn timer-reset-btn" id="resetBtn">
                            <i class="fas fa-redo-alt"></i> 重設
                        </button>
                    </div>
                    
                    <!-- Lap List (only visible for stopwatch) -->
                    <div class="stopwatch-lap-list" id="lapList" style="display: none;">
                        <!-- Laps will be added here dynamically -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 確保DOM完全加載後再執行腳本
        document.addEventListener('DOMContentLoaded', function() {
            // 系統配置
            const activities = [
                '編程', '建造', '練習', 'AWP', 'notebook',
                // 擴展點：在此添加新活動類型
            ];

            // 全局變量
            let records = [];
            let matchRecords = [];
            let skillRecords = [];
            let activeButton = null;
            let startTime = null;
            let currentTheme = 'light';
            let currentTab = 'timeTracking';
            let selectedMode = 'manual';
            
            // 保存用戶偏好設置
            let userPreferences = {
                isPractice: false
            };

            // DOM元素 - 時間記錄相關
            const timeDisplay = document.getElementById('currentTimeDisplay');
            const clearBtn = document.getElementById('clearBtn');
            const exportBtn = document.getElementById('exportBtn');
            const recordsList = document.getElementById('recordsList');
            const themeToggle = document.getElementById('themeToggle');
            const body = document.body;
            const activityButtonsContainer = document.getElementById('activityButtonsContainer');
            
            // DOM元素 - 選項卡切換相關
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');
            
            // DOM元素 - 比賽記錄相關
            const saveMatchBtn = document.getElementById('saveMatchBtn');
            const clearMatchBtn = document.getElementById('clearMatchBtn');
            const exportMatchBtn = document.getElementById('exportMatchBtn');
            const matchRecordsList = document.getElementById('matchRecordsList');
            
            // DOM元素 - 技能賽記錄相關
            const radioBtns = document.querySelectorAll('.radio-btn');
            const saveSkillBtn = document.getElementById('saveSkillBtn');
            const clearSkillBtn = document.getElementById('clearSkillBtn');
            const exportSkillBtn = document.getElementById('exportSkillBtn');
            const skillRecordsList = document.getElementById('skillRecordsList');
            const isPracticeCheck = document.getElementById('isPractice');
            
            // DOM元素 - 計時器及秒錶相關
            const timerTab = document.getElementById('timerTab');
            const stopwatchTab = document.getElementById('stopwatchTab');
            const timerDisplay = document.getElementById('timeDisplay');
            const pauseBtn = document.getElementById('pauseBtn');
            const resetBtn = document.getElementById('resetBtn');
            const soundToggle = document.getElementById('soundToggle');
            //const fullscreenToggle = document.getElementById('fullscreenToggle');
            const timerProgress = document.getElementById('timerProgress');
            const timerIndicator = document.getElementById('timerIndicator');
            const lapList = document.getElementById('lapList');
            const timerContainer = document.querySelector('.timer-container');
            
            // 計時器及秒錶變量
            let timerMode = 'timer'; // 'timer' or 'stopwatch'
            let isTimerRunning = false;
            let timerInterval = null;
            let timerStartTime = 0;
            let timerElapsedTime = 0;
            let timerPausedTime = 0;
            let soundEnabled = true;
            let isFullscreen = false;
            let laps = [];
            let targetTime = 60; // Default 1 minute in seconds
            
            // 初始化計時器UI
            updateTimerDisplay();
            
            // 事件監聽器 - 計時器及秒錶相關
            timerTab.addEventListener('click', () => switchTimerMode('timer'));
            stopwatchTab.addEventListener('click', () => switchTimerMode('stopwatch'));
            
            pauseBtn.addEventListener('click', toggleTimerPause);
            resetBtn.addEventListener('click', resetTimerStopwatch);
            
            soundToggle.addEventListener('click', toggleSound);
            //fullscreenToggle.addEventListener('click', toggleFullscreen);
            
            // 函數 - 計時器及秒錶相關
            function switchTimerMode(newMode) {
                if (timerMode === newMode) return;
                
                // 重置當前模式
                clearInterval(timerInterval);
                isTimerRunning = false;
                timerPausedTime = 0;
                timerElapsedTime = 0;
                
                // 更新UI為新模式
                timerMode = newMode;
                updateTimerModeUI();
                resetTimerStopwatch();
            }
            
            function updateTimerModeUI() {
                if (timerMode === 'timer') {
                    timerTab.classList.add('active');
                    stopwatchTab.classList.remove('active');
                    pauseBtn.innerHTML = '<i class="fas fa-play"></i> 開始';
                    lapList.style.display = 'none';
                    targetTime = 60; // 默認1分鐘
                } else {
                    timerTab.classList.remove('active');
                    stopwatchTab.classList.add('active');
                    pauseBtn.innerHTML = '<i class="fas fa-play"></i> 開始';
                    laps = [];
                    lapList.style.display = 'block';
                    lapList.innerHTML = '';
                }
                
                updateTimerDisplay();
            }
            
            function toggleTimerPause() {
                if (!isTimerRunning) {
                    // 開始計時器/秒錶
                    timerStartTime = Date.now() - timerElapsedTime;
                    timerInterval = setInterval(updateTimer, 10);
                    isTimerRunning = true;
                    pauseBtn.innerHTML = '<i class="fas fa-pause"></i> 暫停';
                } else {
                    // 暫停計時器/秒錶
                    clearInterval(timerInterval);
                    timerPausedTime = Date.now() - timerStartTime;
                    timerElapsedTime = timerPausedTime;
                    isTimerRunning = false;
                    pauseBtn.innerHTML = '<i class="fas fa-play"></i> 開始';
                }
            }
            
            function updateTimer() {
                const now = Date.now();
                timerElapsedTime = now - timerStartTime;
                
                if (timerMode === 'timer') {
                    const remainingTime = Math.max(0, targetTime * 1000 - timerElapsedTime);
                    
                    if (remainingTime <= 0) {
                        clearInterval(timerInterval);
                        isTimerRunning = false;
                        pauseBtn.innerHTML = '<i class="fas fa-play"></i> 開始';
                        if (soundEnabled) {
                            playAlarmSound();
                        }
                    }
                    
                    // 更新進度圓圈
                    const progress = 1 - (remainingTime / (targetTime * 1000));
                    updateProgressCircle(progress);
                    
                    // 更新顯示
                    const minutes = Math.floor(remainingTime / 60000);
                    const seconds = Math.floor((remainingTime % 60000) / 1000);
                    
                    timerDisplay.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                } else {
                    // 秒錶模式
                    updateProgressCircle(timerElapsedTime / (60 * 1000)); // 1分鐘後完成一圈
                    
                    const milliseconds = Math.floor((timerElapsedTime % 1000) / 10);
                    const seconds = Math.floor((timerElapsedTime / 1000) % 60);
                    const minutes = Math.floor((timerElapsedTime / (1000 * 60)) % 60);
                    
                    // Adjust font size based on content length to ensure it fits in the circle
                    const timeString = `${minutes}:${seconds.toString().padStart(2, '0')}.${milliseconds.toString().padStart(2, '0')}`;
                    timerDisplay.textContent = timeString;
                    
                    // Dynamically adjust font size if needed
                    if (minutes >= 10) {
                        timerDisplay.style.fontSize = '50px';
                    } else {
                        timerDisplay.style.fontSize = '60px';
                    }
                }
            }
            
            function updateTimerDisplay() {
                if (timerMode === 'timer') {
                    const minutes = Math.floor(targetTime / 60);
                    const seconds = targetTime % 60;
                    timerDisplay.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                    // Reset font size to default
                    timerDisplay.style.fontSize = '60px';
                    updateProgressCircle(0);
                } else {
                    timerDisplay.textContent = '0:00.00';
                    // Reset font size to default
                    timerDisplay.style.fontSize = '60px';
                    updateProgressCircle(0);
                }
            }
            
            function resetTimerStopwatch() {
                clearInterval(timerInterval);
                isTimerRunning = false;
                timerElapsedTime = 0;
                timerPausedTime = 0;
                
                if (timerMode === 'timer') {
                    pauseBtn.innerHTML = '<i class="fas fa-play"></i> 開始';
                } else {
                    pauseBtn.innerHTML = '<i class="fas fa-play"></i> 開始';
                    laps = [];
                    lapList.innerHTML = '';
                }
                
                updateTimerDisplay();
                
                // 如果在秒錶模式且正在運行，添加一個分段記錄
                if (timerMode === 'stopwatch' && isTimerRunning) {
                    addLap();
                }
            }
            
            function addLap() {
                laps.push(timerElapsedTime);
                
                const lapItem = document.createElement('div');
                lapItem.className = 'stopwatch-lap-item';
                
                const lapNumber = document.createElement('div');
                lapNumber.className = 'stopwatch-lap-number';
                lapNumber.textContent = `Lap ${laps.length}`;
                
                const lapTime = document.createElement('div');
                lapTime.className = 'stopwatch-lap-time';
                
                const milliseconds = Math.floor((timerElapsedTime % 1000) / 10);
                const seconds = Math.floor((timerElapsedTime / 1000) % 60);
                const minutes = Math.floor((timerElapsedTime / (1000 * 60)) % 60);
                
                lapTime.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}.${milliseconds.toString().padStart(2, '0')}`;
                
                lapItem.appendChild(lapNumber);
                lapItem.appendChild(lapTime);
                
                lapList.insertBefore(lapItem, lapList.firstChild);
            }
            
            function toggleSound() {
                soundEnabled = !soundEnabled;
                
                if (soundEnabled) {
                    soundToggle.innerHTML = '<i class="fas fa-volume-up"></i>';
                } else {
                    soundToggle.innerHTML = '<i class="fas fa-volume-mute"></i>';
                }
            }
            
            /*function toggleFullscreen() {
                isFullscreen = !isFullscreen;
                
                if (isFullscreen) {
                    timerContainer.classList.add('timer-fullscreen');
                    fullscreenToggle.innerHTML = '<i class="fas fa-compress"></i>';
                } else {
                    timerContainer.classList.remove('timer-fullscreen');
                    fullscreenToggle.innerHTML = '<i class="fas fa-expand"></i>';
                }
            }
            */
            function updateProgressCircle(progress) {
                // 旋轉指示器
                const degrees = progress * 360;
                timerIndicator.style.transform = `rotate(${degrees}deg)`;
                
                // 更新進度圓圈
                if (progress >= 0.5) {
                    timerProgress.style.clip = 'rect(0, 280px, 280px, 0)';
                } else {
                    timerProgress.style.clip = 'rect(0, 280px, 280px, 140px)';
                }
            }
            
            function playAlarmSound() {
                try {
                    const audio = new Audio('https://cdn.jsdelivr.net/gh/festi/audio-assets@main/sounds/alarm.mp3');
                    audio.play();
                } catch (error) {
                    console.error('Failed to play alarm sound:', error);
                }
            }
            
            // 初始化活動按鈕
            function initActivityButtons() {
                activities.forEach(activity => {
                    const button = document.createElement('button');
                    button.className = 'activity-btn py-3';
                    button.textContent = activity;
                    button.dataset.activity = activity;
                    
                    button.addEventListener('click', function() {
                        toggleActivity(this);
                    });
                    
                    activityButtonsContainer.appendChild(button);
                });
            }
            
            // 切換活動狀態
            function toggleActivity(button) {
                const activity = button.dataset.activity;
                
                if (button.classList.contains('active')) {
                    // 結束活動
                    button.classList.remove('active');
                    const endTime = new Date();
                    const duration = calculateDuration(startTime, endTime);
                    
                    // 記錄活動
                    records.push({
                        activity: activity,
                        startTime: formatDateTime(startTime),
                        endTime: formatDateTime(endTime),
                        duration: duration
                    });
                    
                    // 更新記錄列表
                    updateRecordsList();
                    
                    // 清除當前活動
                    activeButton = null;
                    startTime = null;
                } else {
                    // 如果有正在進行的活動，先結束它
                    if (activeButton) {
                        toggleActivity(activeButton);
                    }
                    
                    // 開始新活動
                    button.classList.add('active');
                    activeButton = button;
                    startTime = new Date();
                }
            }
            
            // 計算持續時間
            function calculateDuration(start, end) {
                const diff = end - start; // 毫秒差
                const seconds = Math.floor(diff / 1000);
                const minutes = Math.floor(seconds / 60);
                const hours = Math.floor(minutes / 60);
                
                return `${hours.toString().padStart(2, '0')}:${(minutes % 60).toString().padStart(2, '0')}:${(seconds % 60).toString().padStart(2, '0')}`;
            }
            
            // 格式化日期時間
            function formatDateTime(date) {
                return `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')} ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}:${date.getSeconds().toString().padStart(2, '0')}`;
            }
            
            // 更新記錄列表
            function updateRecordsList() {
                if (records.length === 0) {
                    recordsList.innerHTML = '<div class="text-center text-gray-500 py-4">尚無記錄</div>';
                    return;
                }
                
                recordsList.innerHTML = '';
                
                // 按時間倒序排列
                const sortedRecords = [...records].reverse();
                
                sortedRecords.forEach((record, index) => {
                    const recordItem = document.createElement('div');
                    recordItem.className = 'record-item';
                    recordItem.innerHTML = `
                        <div class="flex justify-between items-center">
                            <div class="font-bold">${record.activity}</div>
                            <div class="text-sm text-gray-500">${record.duration}</div>
                        </div>
                        <div class="text-sm mt-1">
                            <span class="text-gray-500">開始：</span>${record.startTime.split(' ')[1]}
                            <span class="text-gray-500 ml-2">結束：</span>${record.endTime.split(' ')[1]}
                        </div>
                    `;
                    
                    recordsList.appendChild(recordItem);
                });
            }
            
            // 清除記錄
            function clearRecords() {
                if (confirm('確定要清除所有活動記錄嗎？此操作不可撤銷。')) {
                    records = [];
                    updateRecordsList();
                }
            }
            
            // 導出Excel
            function exportToExcel() {
                if (records.length === 0) {
                    alert('沒有記錄可導出');
                    return;
                }
                
                // 準備數據
                const worksheet = XLSX.utils.json_to_sheet(records);
                
                // 創建工作簿
                const workbook = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(workbook, worksheet, "活動記錄");
                
                // 導出
                XLSX.writeFile(workbook, `活動記錄_${formatDateForFilename(new Date())}.xlsx`);
            }
            
            // 日期格式化為文件名
            function formatDateForFilename(date) {
                return `${date.getFullYear()}${(date.getMonth() + 1).toString().padStart(2, '0')}${date.getDate().toString().padStart(2, '0')}_${date.getHours().toString().padStart(2, '0')}${date.getMinutes().toString().padStart(2, '0')}${date.getSeconds().toString().padStart(2, '0')}`;
            }
            
            // 選項卡切換
            function switchTab(tabId) {
                tabs.forEach(tab => tab.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active'));
                
                document.querySelector(`.tab[data-tab="${tabId}"]`).classList.add('active');
                document.getElementById(tabId).classList.add('active');
                
                currentTab = tabId;
            }
            
            // 切換主題
            function toggleTheme() {
                if (body.classList.contains('light-theme')) {
                    body.classList.remove('light-theme');
                    body.classList.add('dark-theme');
                    themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
                    currentTheme = 'dark';
                } else {
                    body.classList.remove('dark-theme');
                    body.classList.add('light-theme');
                    themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
                    currentTheme = 'light';
                }
            }
            
            // 模式選擇切換
            function switchMode(modeBtn) {
                radioBtns.forEach(btn => btn.classList.remove('active'));
                modeBtn.classList.add('active');
                selectedMode = modeBtn.dataset.mode;
            }
            
            // 保存比賽記錄
            function saveMatchRecord() {
                const matchDate = document.getElementById('matchDate').value;
                const matchCount = document.getElementById('matchCount').value;
                const myTeamNumber = document.getElementById('myTeamNumber').value;
                const teammateNumber = document.getElementById('teammateNumber').value;
                const myTeamScore = document.getElementById('myTeamScore').value;
                const myTeamAutoWin = document.getElementById('myTeamAutoWin').checked;
                const opponentTeam1 = document.getElementById('opponentTeam1').value;
                const opponentTeam2 = document.getElementById('opponentTeam2').value;
                const opponentScore = document.getElementById('opponentScore').value;
                const opponentAutoWin = document.getElementById('opponentAutoWin').checked;
                
                // 驗證必填字段
                if (!matchDate) {
                    alert('請選擇比賽日期');
                    return;
                }
                
                if (!matchCount) {
                    alert('請輸入場數/回合');
                    return;
                }
                
                if (!myTeamNumber) {
                    alert('請輸入紅方1編號/名稱');
                    return;
                }
                
                if (myTeamScore === '') {
                    alert('請輸入紅方分數');
                    return;
                }
                
                if (!opponentTeam1) {
                    alert('請輸入藍方1編號/名稱');
                    return;
                }
                
                if (opponentScore === '') {
                    alert('請輸入藍方分數');
                    return;
                }
                
                // 創建記錄對象
                const record = {
                    date: matchDate,
                    match: matchCount,
                    redTeam1: myTeamNumber,
                    redTeam2: teammateNumber,
                    redScore: parseInt(myTeamScore),
                    redAutoWin: myTeamAutoWin,
                    blueTeam1: opponentTeam1,
                    blueTeam2: opponentTeam2,
                    blueScore: parseInt(opponentScore),
                    blueAutoWin: opponentAutoWin,
                    timestamp: new Date().toISOString()
                };
                
                // 添加到記錄數組
                matchRecords.push(record);
                
                // 更新UI
                updateMatchRecordsList();
                
                // 清空表單
                document.getElementById('matchCount').value = '';
                document.getElementById('myTeamScore').value = '';
                document.getElementById('myTeamAutoWin').checked = false;
                document.getElementById('opponentScore').value = '';
                document.getElementById('opponentAutoWin').checked = false;
                
                alert('比賽記錄已保存');
            }
            
            // 更新比賽記錄列表
            function updateMatchRecordsList() {
                if (matchRecords.length === 0) {
                    matchRecordsList.innerHTML = '<div class="text-center text-gray-500 py-4">尚無比賽記錄</div>';
                    return;
                }
                
                matchRecordsList.innerHTML = '';
                
                // 按時間戳倒序排列
                const sortedRecords = [...matchRecords].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                
                sortedRecords.forEach(record => {
                    const winner = record.redScore > record.blueScore ? 'red' : (record.blueScore > record.redScore ? 'blue' : 'tie');
                    const recordItem = document.createElement('div');
                    recordItem.className = 'record-item';
                    
                    let redAutoText = record.redAutoWin ? '（自動勝）' : '';
                    let blueAutoText = record.blueAutoWin ? '（自動勝）' : '';
                    
                    recordItem.innerHTML = `
                        <div class="flex justify-between items-center">
                            <div class="font-bold">${record.date} - ${record.match}</div>
                        </div>
                        <div class="mt-2 grid grid-cols-3 gap-2">
                            <div class="${winner === 'red' ? 'font-bold text-red-500' : ''}">
                                <div>紅方：${record.redTeam1}${record.redTeam2 ? '/' + record.redTeam2 : ''}</div>
                                <div>分數：${record.redScore}${redAutoText}</div>
                            </div>
                            <div class="text-center flex items-center justify-center">
                                <span class="font-bold">VS</span>
                            </div>
                            <div class="${winner === 'blue' ? 'font-bold text-blue-500' : ''}">
                                <div>藍方：${record.blueTeam1}${record.blueTeam2 ? '/' + record.blueTeam2 : ''}</div>
                                <div>分數：${record.blueScore}${blueAutoText}</div>
                            </div>
                        </div>
                    `;
                    
                    matchRecordsList.appendChild(recordItem);
                });
            }
            
            // 清除比賽記錄
            function clearMatchRecords() {
                if (confirm('確定要清除所有比賽記錄嗎？此操作不可撤銷。')) {
                    matchRecords = [];
                    updateMatchRecordsList();
                }
            }
            
            // 導出比賽記錄為Excel
            function exportMatchRecords() {
                if (matchRecords.length === 0) {
                    alert('沒有比賽記錄可導出');
                    return;
                }
                
                // 準備數據
                const worksheet = XLSX.utils.json_to_sheet(matchRecords.map(record => {
                    // 創建一個新對象，僅包含要導出的字段
                    return {
                        '日期': record.date,
                        '場次/回合': record.match,
                        '紅方1': record.redTeam1,
                        '紅方2': record.redTeam2 || '',
                        '紅方分數': record.redScore,
                        '紅方自動模式獲勝': record.redAutoWin ? '是' : '否',
                        '藍方1': record.blueTeam1,
                        '藍方2': record.blueTeam2 || '',
                        '藍方分數': record.blueScore,
                        '藍方自動模式獲勝': record.blueAutoWin ? '是' : '否'
                    };
                }));
                
                // 創建工作簿
                const workbook = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(workbook, worksheet, "比賽記錄");
                
                // 導出
                XLSX.writeFile(workbook, `比賽記錄_${formatDateForFilename(new Date())}.xlsx`);
            }
            
            // 保存技能賽記錄
            function saveSkillRecord() {
                const skillDate = document.getElementById('skillDate').value;
                const skillScore = document.getElementById('skillScore').value;
                const skillTime = document.getElementById('skillTime').value;
                const isPractice = document.getElementById('isPractice').checked;
                
                // 驗證必填字段
                if (!skillDate) {
                    alert('請選擇比賽日期');
                    return;
                }
                
                if (skillScore === '') {
                    alert('請輸入分數');
                    return;
                }
                
                if (skillTime === '') {
                    alert('請輸入所用時間');
                    return;
                }
                
                // 創建記錄對象
                const record = {
                    date: skillDate,
                    score: parseInt(skillScore),
                    time: parseFloat(skillTime),
                    mode: selectedMode,
                    isPractice: isPractice,
                    timestamp: new Date().toISOString()
                };
                
                // 添加到記錄數組
                skillRecords.push(record);
                
                // 更新UI
                updateSkillRecordsList();
                
                // 保存用戶偏好設置
                userPreferences.isPractice = isPractice;
                
                // 清空表單
                document.getElementById('skillScore').value = '';
                document.getElementById('skillTime').value = '60.0';
                
                alert('技能賽記錄已保存');
            }
            
            // 更新技能賽記錄列表
            function updateSkillRecordsList() {
                if (skillRecords.length === 0) {
                    skillRecordsList.innerHTML = '<div class="text-center text-gray-500 py-4">尚無技能賽記錄</div>';
                    return;
                }
                
                skillRecordsList.innerHTML = '';
                
                // 按時間戳倒序排列
                const sortedRecords = [...skillRecords].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                
                sortedRecords.forEach(record => {
                    const recordItem = document.createElement('div');
                    recordItem.className = 'record-item';
                    
                    recordItem.innerHTML = `
                        <div class="flex justify-between items-center">
                            <div class="font-bold">${record.date}${record.isPractice ? ' (練習)' : ''}</div>
                            <div class="text-sm ${record.mode === 'auto' ? 'text-blue-500' : 'text-green-500'}">
                                ${record.mode === 'auto' ? '自動模式' : '手動模式'}
                            </div>
                        </div>
                        <div class="mt-2 grid grid-cols-2 gap-2">
                            <div>
                                <span class="text-gray-500">分數：</span>
                                <span class="font-bold">${record.score}</span>
                            </div>
                            <div>
                                <span class="text-gray-500">時間：</span>
                                <span class="font-bold">${record.time.toFixed(1)}秒</span>
                            </div>
                        </div>
                    `;
                    
                    skillRecordsList.appendChild(recordItem);
                });
            }
            
            // 清除技能賽記錄
            function clearSkillRecords() {
                if (confirm('確定要清除所有技能賽記錄嗎？此操作不可撤銷。')) {
                    skillRecords = [];
                    updateSkillRecordsList();
                }
            }
            
            // 導出技能賽記錄為Excel
            function exportSkillRecords() {
                if (skillRecords.length === 0) {
                    alert('沒有技能賽記錄可導出');
                    return;
                }
                
                // 準備數據
                const worksheet = XLSX.utils.json_to_sheet(skillRecords.map(record => {
                    // 創建一個新對象，僅包含要導出的字段
                    return {
                        '日期': record.date,
                        '分數': record.score,
                        '時間（秒）': record.time,
                        '模式': record.mode === 'auto' ? '自動' : '手動',
                        '練習': record.isPractice ? '是' : '否'
                    };
                }));
                
                // 創建工作簿
                const workbook = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(workbook, worksheet, "技能賽記錄");
                
                // 導出
                XLSX.writeFile(workbook, `技能賽記錄_${formatDateForFilename(new Date())}.xlsx`);
            }
            
            // 檢測系統暗色模式
            function detectSystemTheme() {
                if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    body.classList.remove('light-theme');
                    body.classList.add('dark-theme');
                    themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
                    currentTheme = 'dark';
                }
                
                // 添加監聽器以響應系統主題變化
                window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
                    if (event.matches) {
                        body.classList.remove('light-theme');
                        body.classList.add('dark-theme');
                        themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
                        currentTheme = 'dark';
                    } else {
                        body.classList.remove('dark-theme');
                        body.classList.add('light-theme');
                        themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
                        currentTheme = 'light';
                    }
                });
            }
            
            // 初始化本地存儲
            function loadFromLocalStorage() {
                const savedRecords = localStorage.getItem('records');
                if (savedRecords) {
                    records = JSON.parse(savedRecords);
                    updateRecordsList();
                }
                
                const savedMatchRecords = localStorage.getItem('matchRecords');
                if (savedMatchRecords) {
                    matchRecords = JSON.parse(savedMatchRecords);
                    updateMatchRecordsList();
                }
                
                const savedSkillRecords = localStorage.getItem('skillRecords');
                if (savedSkillRecords) {
                    skillRecords = JSON.parse(savedSkillRecords);
                    updateSkillRecordsList();
                }
                
                const savedPreferences = localStorage.getItem('userPreferences');
                if (savedPreferences) {
                    userPreferences = JSON.parse(savedPreferences);
                    
                    // 應用保存的偏好設置
                    if (isPracticeCheck) {
                        isPracticeCheck.checked = userPreferences.isPractice;
                    }
                }
            }
            
            // 保存到本地存儲
            function saveToLocalStorage() {
                localStorage.setItem('records', JSON.stringify(records));
                localStorage.setItem('matchRecords', JSON.stringify(matchRecords));
                localStorage.setItem('skillRecords', JSON.stringify(skillRecords));
                localStorage.setItem('userPreferences', JSON.stringify(userPreferences));
            }
            
            // 綁定事件監聽器
            clearBtn.addEventListener('click', clearRecords);
            exportBtn.addEventListener('click', exportToExcel);
            themeToggle.addEventListener('click', toggleTheme);
            
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    switchTab(tab.dataset.tab);
                });
            });
            
            radioBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    switchMode(btn);
                });
            });
            
            if (saveMatchBtn) {
                saveMatchBtn.addEventListener('click', saveMatchRecord);
            }
            
            if (clearMatchBtn) {
                clearMatchBtn.addEventListener('click', clearMatchRecords);
            }
            
            if (exportMatchBtn) {
                exportMatchBtn.addEventListener('click', exportMatchRecords);
            }
            
            if (saveSkillBtn) {
                saveSkillBtn.addEventListener('click', saveSkillRecord);
            }
            
            if (clearSkillBtn) {
                clearSkillBtn.addEventListener('click', clearSkillRecords);
            }
            
            if (exportSkillBtn) {
                exportSkillBtn.addEventListener('click', exportSkillRecords);
            }
            
            // 自動保存數據
            setInterval(saveToLocalStorage, 5000);
            
            // 初始化應用
            initActivityButtons();
            detectSystemTheme();
            loadFromLocalStorage();
            
            // 設置當前時間顯示
            setInterval(() => {
                const now = new Date();
                const timeString = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`;
                timeDisplay.textContent = timeString;
            }, 1000);
        });
    </script>
</body>
</html>
